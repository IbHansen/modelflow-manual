

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. Modelflow extensions to pandas &#8212; The World Bank&#39;s MFMod Framework in Python with Modelflow</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/04_PythonEssentials/UpdateCommand';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.6. .mfcalc() an extension of standard Pandas" href="mfcalc.html" />
    <link rel="prev" title="2. Some Python basics" href="PythonPandasDataframes.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../introduction.html">
  
  
  
  
  
    <p class="title logo__title">The World Bank's MFMod Framework in Python with Modelflow</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../introduction.html">
                    <no title>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The World Bank's MFMod Framework and Modelflow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_MacrostructuralModels/MacroStructuralModels.html">1. Macrostructural models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_MacrostructuralModels/MFModAndModelFlow.html">2. Modelflow and the MFMod models of the World Bank</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Installation/Installing.html">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Installation/TestingModelFlow.html">4. Testing your installation of modelflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">5. Index</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Some python essentials for using World Bank models with modelflow</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Intro_Jupyter_notebook.html">1. Introduction to  Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="PythonPandasDataframes.html">2. Some Python basics</a></li>

<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">4. Modelflow extensions to pandas</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mfcalc.html">4.6. <code class="docutils literal notranslate"><span class="pre">.mfcalc()</span></code> an extension of standard Pandas</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using modelflow with World Bank models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../05_WBModels/LoadingWBModel.html">1. Using <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> with World Bank models</a></li>

<li class="toctree-l1"><a class="reference internal" href="../05_WBModels/ScenarioAnalysis.html">3. Scenario analysis</a></li>

<li class="toctree-l1"><a class="reference internal" href="../05_WBModels/MoreComplexScenarios.html">5. More complex scenarios</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Analytics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../06_ModelAnalytics/ModelStructure.html">1. Model analytics</a></li>



<li class="toctree-l1"><a class="reference internal" href="../06_ModelAnalytics/AttributionSomeFeatures.html">5. Analyzing the impact of a shock</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Technical how tos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../07_MoreFeatures/GettingHelp.html">1. Getting Help</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/IbHansen/modelflow-manual/blob/AndrewEdits/papers/mfbook/content/04_PythonEssentials/UpdateCommand.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/IbHansen/modelflow-manual" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/04_PythonEssentials/UpdateCommand.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modelflow extensions to pandas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-python-environment">4.1. Setting up the python environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#column-names-in-modelflow">4.2. Column names in  Modelflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#index-and-time-dimensions-in-modelflow">4.3. .index and time dimensions in Modelflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leads-and-lags">4.4. Leads and lags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-method-of-modelflow">4.5. .upd() method of modelflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-method-operators">4.5.1. <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-some-examples">4.5.2. <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> some examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-upd-to-create-a-new-variable-operator">4.5.2.1. Use .upd to create a new variable (= operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-updates-and-specific-time-periods">4.5.2.2. Multiple updates and specific time periods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-specific-datapoints-to-specific-values">4.5.2.3. Setting specific datapoints to specific values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator">4.5.2.4. Adding  the specified  values to all values in a range (the + operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator">4.5.2.5. Multiplying all values in a range by the specified values (the * operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">4.5.2.6. Increasing all  values in a range by a  specified percent amount (the % operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-percent-growth-rate-to-specified-values-growth">4.5.2.7. Set the percent growth rate to specified values (=GROWTH)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">4.5.2.8. Add or subtract from the existing percent growth rate (+GROWTH operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-change-in-a-variable-to-specific-values-diff-operator">4.5.2.9. Set the change in a variable to specific values (=diff operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#update-several-variable-in-one-line">4.5.2.10. Update several variable in one line</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selected-upd-options">4.5.3. Selected <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> options</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-keep-growth-option-kg-and-nkg">4.5.3.1. The keep_growth option (–kg and –nkg)</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#the-default-keep-growth-behaviour">4.5.3.1.1. The default keep_growth behaviour</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-keep-growth-some-more-examples">4.5.3.2. .upd(,,,keep_growth) some more examples</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-with-the-option-keep-growth-set-globally">4.5.3.3. .upd() with the option keep_growth set globally</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-scale-number-default-1-scale-the-updates">4.5.3.4. .upd(,,scale=&lt;number, default=1&gt;) Scale the updates</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-lprint-true-prints-values-the-before-and-after-update">4.5.3.5. .upd(,,lprint=True ) prints values the before and after update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-create-true-requires-the-variable-to-exist">4.5.3.6. .upd(,,create=True ) Requires the variable to exist</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelflow-extensions-to-pandas">
<h1><span class="section-number">4. </span>Modelflow extensions to pandas<a class="headerlink" href="#modelflow-extensions-to-pandas" title="Permalink to this headline">#</a></h1>
<p>Any class can have both properties (data) and methods (functions that operate on the data of the particular instance of the class). With object-oriented programming languages like python, classes can be built as supersets of existing classes. The <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> class <code class="docutils literal notranslate"><span class="pre">model</span></code> inherits or encapsulates all of the features of the pandas dataframe and extends it in many important ways.  Some of the methods below are standard pandas methods, others have been added to it by <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> features</p>
<p>Data in a dataframe can be modified directly with built-in pandas functionalities like <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> and <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, but <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> extends these capabilities with in important ways with the <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> and <code class="docutils literal notranslate"><span class="pre">.mfcalc()</span></code> methods.</p>
<section id="setting-up-the-python-environment">
<h2><span class="section-number">4.1. </span>Setting up the python environment<a class="headerlink" href="#setting-up-the-python-environment" title="Permalink to this headline">#</a></h2>
<p>In order to use <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> all of the necessary libraries must be <strong>imported</strong> into the python session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="c1"># First import pandas and the model into the  workspace</span>
<span class="c1"># There is no problem importing multiple times, though it is not very efficient.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">modelclass</span> <span class="kn">import</span> <span class="n">model</span> 
<span class="c1"># functions that improve rendering of modelflow outputs under Jupyter Notebook</span>
<span class="n">model</span><span class="o">.</span><span class="n">widescreen</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">scroll_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <style>
            div#notebook-container    { width: 95%; }
            div#menubar-container     { width: 65%; }
            div#maintoolbar-container { width: 99%; }
        </style>
        </div></div>
</div>
</section>
<section id="column-names-in-modelflow">
<h2><span class="section-number">4.2. </span>Column names in  Modelflow<a class="headerlink" href="#column-names-in-modelflow" title="Permalink to this headline">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title">Modelflow variable names</p>
<p>Modelflow places more restrictions on column names than do pandas <em>per se</em>.</p>
</aside>
<p>While pandas dataframes are very liberal in what names can be given to columns, <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> is more restrictive.</p>
<p>Specifically, in modelflow a variable name must:</p>
<ul class="simple">
<li><p>start with a letter</p></li>
<li><p>be upper case</p></li>
</ul>
<p>Thus while all these are legal column names in pandas, some are illegal in modelflow.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-left head"><p>Variable Name</p></th>
<th class="text-left head"><p>Legal in</br> modelfow?</p></th>
<th class="text-left head"><p>Reason</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>IB</p></td>
<td class="text-left"><p>yes</p></td>
<td class="text-left"><p><span style='color:Green'>Starts with a letter and is uppercase</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>ib</p></td>
<td class="text-left"><p>no</p></td>
<td class="text-left"><p><span style='color:red'> lowercase letters are not allowed</span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>42ANSWER</p></td>
<td class="text-left"><p>No</p></td>
<td class="text-left"><p><span style='color:Red'> does not start with a letter </span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>_HORSE1</p></td>
<td class="text-left"><p>No</p></td>
<td class="text-left"><p><span style='color:Red'>does not start with a letter </span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>A_VERY_LONG_NAME_THAT_IS_LEGAL_3</p></td>
<td class="text-left"><p>Yes</p></td>
<td class="text-left"><p><span style='color:Green'> Starts with a letter and is uppercase </span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="index-and-time-dimensions-in-modelflow">
<h2><span class="section-number">4.3. </span>.index and time dimensions in Modelflow<a class="headerlink" href="#index-and-time-dimensions-in-modelflow" title="Permalink to this headline">#</a></h2>
<p>As we saw above, series have indices.  Dataframes also have indices, which are the row names of the dataframe.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> the index series is typically understood to represent a date.</p>
<p>For yearly models a list of integers like in the above example works fine.<br></p>
<p>For higher frequency models (quarterly, monthly, weekly,daily, etc.) the index can be one of pandas datatypes.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not all datetypes work well with the graphics routines of modelflow.  Users are advised to use the <code class="docutils literal notranslate"><span class="pre">pd.period_range()</span></code> method to generate date indexes.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1975q1&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;2125q4&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">dates</span>
</pre></div>
</div>
</div>
</section>
<section id="leads-and-lags">
<h2><span class="section-number">4.4. </span>Leads and lags<a class="headerlink" href="#leads-and-lags" title="Permalink to this headline">#</a></h2>
<p>In modelflow leads and lags can be indicated by following the variable with a parenthesis and either -1 or -2 two for one or two period lags (where the number following the negative sign indicates the number of time periods that are lagged). Positive numbers are used for forward leads (no +sign required).</p>
<p>When a method defined by the <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> class encounters something like <code class="docutils literal notranslate"><span class="pre">A(-1)</span></code>, it will take the value from the row above the current row. No matter if the index is an integer, a year, quarter or a millisecond. The same goes for leads, <code class="docutils literal notranslate"><span class="pre">A(+1)</span></code> will return the value of <code class="docutils literal notranslate"><span class="pre">A</span></code> in the next row.</p>
<p>As a result in a quarterly model <code class="docutils literal notranslate"><span class="pre">B=A(-4)</span></code> would assign B the value of A from the same quarter in the previous year.</p>
</section>
<section id="upd-method-of-modelflow">
<h2><span class="section-number">4.5. </span>.upd() method of modelflow<a class="headerlink" href="#upd-method-of-modelflow" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method extends pandas by giving the user a concise and expressive way to modify data in a <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> using a syntax that a database-manager or macroeconomic modeler might find more natural.</p>
<p>Notably it allows the user to employ formula’s to do updates, and supports both lags and leads on variables.</p>
<p><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> can be used to:</p>
<ul class="simple">
<li><p>Perform different types of  updates</p></li>
<li><p>Perform multiple updates each on a new line</p></li>
<li><p>Perform changes over specific periods</p></li>
<li><p>Use one input which is used for all time frames, or a separate input for each time</p></li>
<li><p>Preserve pre-shock growth rates for out of sample time-periods</p></li>
<li><p>Display results</p></li>
</ul>
<section id="upd-method-operators">
<h3><span class="section-number">4.5.1. </span><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method operators<a class="headerlink" href="#upd-method-operators" title="Permalink to this headline">#</a></h3>
<p>Below are some of the operators that can be used in the <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method</p>
<p><strong>Types of update:</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-left head"><p>Update to perform</p></th>
<th class="text-left head"><p>Use this operator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Set a variable equal to the input</p></td>
<td class="text-left"><p>=</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Add the input to the LHS variable</p></td>
<td class="text-left"><p>+</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Set the variable to itself multiplied by the input</p></td>
<td class="text-left"><p>*</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Increase/Decrease the variable by a percent of itself (1+input/100)</p></td>
<td class="text-left"><p>%</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Set the growth rate of the variable to the input</p></td>
<td class="text-left"><p>=growth</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Change the growth rate of the variable to its current growth rate plus the input value in percentage points</p></td>
<td class="text-left"><p>+growth</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Specify the amount by which the variable should increase from its previous period level (<span class="math notranslate nohighlight">\(\Delta = var_t - var_{t-1}\)</span>)</p></td>
<td class="text-left"><p>=diff</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The syntax of an update command requires that there be a space between variable names and the operators.</p>
<p>Thus <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">=</span> <span class="pre">7&quot;)</span></code> is fine, but <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">=7&quot;)</span></code> will generate an error.</p>
<p>Similarly  <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">*</span> <span class="pre">1.1&quot;)</span></code> is fine, but <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A*</span> <span class="pre">1.1&quot;)</span></code> will generate an error.</p>
</div>
</section>
<section id="upd-some-examples">
<h3><span class="section-number">4.5.2. </span><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> some examples<a class="headerlink" href="#upd-some-examples" title="Permalink to this headline">#</a></h3>
<p>First, create a dataframe using standard pandas syntax.  In this instance with years as the index and a dictionary defining the variables and their data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dataframe using standard pandas</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;C&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span><span class="s1">&#39;E&#39;</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2026</span><span class="p">)])</span>
                  
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="use-upd-to-create-a-new-variable-operator">
<h4><span class="section-number">4.5.2.1. </span>Use .upd to create a new variable (= operator)<a class="headerlink" href="#use-upd-to-create-a-new-variable-operator" title="Permalink to this headline">#</a></h4>
<p>With standard pandas a user can add a column (series) to a dataframe simply by assigning a adding to a dataframe.  For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">df['NEW2']=[17,12,14,15]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> provides this functionality as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;c = 142&#39;</span><span class="p">)</span> 
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>142</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The new variable name was entered as a lower case ‘c’ here.  Lowercase letters are not legal <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> variable names.  The <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method knows that it is part of modelflow and knows this rule. As a result, it automatically translates lowercase entries into upper case so that the statement works.</p>
</div>
</section>
<section id="multiple-updates-and-specific-time-periods">
<h4><span class="section-number">4.5.2.2. </span>Multiple updates and specific time periods<a class="headerlink" href="#multiple-updates-and-specific-time-periods" title="Permalink to this headline">#</a></h4>
<p>The modelflow method <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> takes a string as an argument.  That string can contain a single update command or can contain multiple commands.</p>
<p>Moreover by including a &lt;Begin End&gt; date clause in a given update command, the update will be restricted to the associated time period.</p>
<p>The below illustrates this, modifying two existing variables A, B over different time periods and creating two new variables, <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">D</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The third line inherits the time period of the previous line.</p>
<p>Note also, the submitted string can include comments as well (denoted with the standard python # indicator).</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Same number of values as years</span>
<span class="s2">&lt;2021 2024&gt; A = 42 44 45 46    # 4 years</span>
<span class="s2">&lt;2020     &gt; B = 200            # 1 year </span>
<span class="s2">c = 500                        # Same period as previous line</span>
<span class="s2">&lt;-0 -1&gt; D = 33                   # All years </span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>A</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>200</td>
      <td>500</td>
      <td>4</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>42.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>44.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
      <td>45.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
      <td>46.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-box-time-scope-of-upd-commands admonition">
<p class="admonition-title"><strong>Box  Time scope of .upd() commands</strong></p>
<p>Made this a margin just to see</p>
<p>The update command takes a variety of mathematical operators <code class="docutils literal notranslate"><span class="pre">=,</span> <span class="pre">+,</span> <span class="pre">*,</span> <span class="pre">%</span> <span class="pre">=GROWTH,</span> <span class="pre">+GROWTH,</span> <span class="pre">=DIFF</span></code> and applies them to data for the period set in the leading &lt;&gt;.</p>
<p>If the user wants to modify a series or group of series for only a specific point in time or a period of time, she can indicate the period in the command line.</p>
<ul class="simple">
<li><p>If <strong>one date</strong> is specified the operation is applied to a single point in time</p></li>
<li><p>If <strong>two dates</strong>  are specifies the operation is applied over a period of time.</p></li>
</ul>
<p><strong>The selected time period will persist</strong> until re-set with a new time specification. This is useful to if several variables are going to be updated for the same time period, but must be kept in mind if subsequent commands are to operate over a different time period.</p>
<p>The time period can be rest to the full time-period by using the special &lt;-0 -1&gt; time period.  More generally:</p>
<ul class="simple">
<li><p>-0 indicates the start of the dataframe</p></li>
<li><p>-1 indicates the end of the dataframe</p></li>
</ul>
<p>If no time is provided the dataframe start and end period will be used.</p>
</div>
</section>
<section id="setting-specific-datapoints-to-specific-values">
<h4><span class="section-number">4.5.2.3. </span>Setting specific datapoints to specific values<a class="headerlink" href="#setting-specific-datapoints-to-specific-values" title="Permalink to this headline">#</a></h4>
<p>This example, demonstrates the equals operator.  The <code class="docutils literal notranslate"><span class="pre">=</span></code> operator indicates that the variable a should be set equal to the indicated values following the <code class="docutils literal notranslate"><span class="pre">=</span></code> operator (42 44 45 46 in the first line, 200 in the second and 500 inthe third). The dates enclosed in &lt;&gt; indicate the period over which the change should be applied.</p>
<p>Either:</p>
<ul class="simple">
<li><p>The number of data points provided must match the number of dates in the period, Or</p></li>
<li><p>Only one data point is provided, it is applied to all dates in the period.</p></li>
</ul>
<p>If only one period is to be modified then it can be followed by just one date.</p>
<p>Note that the final line inherited the time period set in the second line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Same number of values as years</span>
<span class="s2">&lt;2021 2024&gt; A = 42 44 45 46    # 4 years</span>
<span class="s2">&lt;2023     &gt; B = 200            # 1 year </span>
<span class="s2">c = 500</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>44.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>200</td>
      <td>500</td>
      <td>4</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="adding-the-specified-values-to-all-values-in-a-range-the-operator">
<h4><span class="section-number">4.5.2.4. </span>Adding  the specified  values to all values in a range (the + operator)<a class="headerlink" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator" title="Permalink to this headline">#</a></h4>
<p>NB: Here upd with the  + operator indicates that we are adding 42.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Or one number to all years in between start and end </span>
<span class="s1">&lt;2022 2024&gt; B  +  42    # one value broadcast to 3 years </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>43</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>43</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>43</td>
      <td>8</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="multiplying-all-values-in-a-range-by-the-specified-values-the-operator">
<h4><span class="section-number">4.5.2.5. </span>Multiplying all values in a range by the specified values (the * operator)<a class="headerlink" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2023&gt; A *  42 44 55</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">
<h4><span class="section-number">4.5.2.6. </span>Increasing all  values in a range by a  specified percent amount (the % operator)<a class="headerlink" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator" title="Permalink to this headline">#</a></h4>
<p>In this example:</p>
<ul class="simple">
<li><p>A is increased by 42 and 44% over the range 2021 through 2022.</p></li>
<li><p>B is increased by 10 percent in all years</p></li>
<li><p>C is a new variable, is created and set to 100 for the whole range (because the previous line set the active range to  &lt;-0 -1&gt;)</p></li>
<li><p>C is decreased by 12 percent over the range 2023 through 2025.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2022 &gt; A %  42 44   </span>
<span class="s1">&lt;-0 -1&gt; B % 10            # all rows </span>
<span class="s1">C = 100                   # all rows persist </span>
<span class="s1">&lt;2023 2025&gt; C % -12       # now only for 3 years </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1.1</td>
      <td>100</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1.1</td>
      <td>100</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1.1</td>
      <td>100</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1.1</td>
      <td>88</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1.1</td>
      <td>88</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1.1</td>
      <td>88</td>
      <td>4</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="set-the-percent-growth-rate-to-specified-values-growth">
<h4><span class="section-number">4.5.2.7. </span>Set the percent growth rate to specified values (=GROWTH)<a class="headerlink" href="#set-the-percent-growth-rate-to-specified-values-growth" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2022&gt; A =GROWTH  1 5  </span>
<span class="s1">&lt;2020&gt; c = 100 </span>
<span class="s1">&lt;2021 2025&gt; c =GROWTH 2 </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># Explained b</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
      B           C  E    A
2020  1  100.000000  4  0.0
2021  1  102.000000  4  0.0
2022  1  104.040000  4  0.0
2023  1  106.120800  4  0.0
2024  1  108.243216  4  0.0
2025  1  110.408080  4  0.0

Growth:
        B    C    E   A
2020  NaN  NaN  NaN NaN
2021  0.0  2.0  0.0 NaN
2022  0.0  2.0  0.0 NaN
2023  0.0  2.0  0.0 NaN
2024  0.0  2.0  0.0 NaN
2025  0.0  2.0  0.0 NaN
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">
<h4><span class="section-number">4.5.2.8. </span>Add or subtract from the existing percent growth rate (+GROWTH operator)<a class="headerlink" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator" title="Permalink to this headline">#</a></h4>
<p>The below example is a bit more complicated.</p>
<p>The first line sets the growth rate of A to 1% in all periods beginning in  2021</p>
<p>The second command adds 2 3 4 5 6 to the growth rates in each period after 2021, resulting in growth rates of 3,4,5,6,7.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 &gt; A =GROWTH  1  # All selected years set to the same growth rate</span>
<span class="s1">a +growth   2  # Add to the existing growth rate these numbers  </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
      B  C  E    A
2020  1  1  4  0.0
2021  1  2  4  NaN
2022  1  3  4  0.0
2023  1  6  4  0.0
2024  1  8  4  0.0
2025  1  9  4  0.0

Growth:
        B           C    E   A
2020  NaN         NaN  NaN NaN
2021  0.0  100.000000  0.0 NaN
2022  0.0   50.000000  0.0 NaN
2023  0.0  100.000000  0.0 NaN
2024  0.0   33.333333  0.0 NaN
2025  0.0   12.500000  0.0 NaN
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-change-in-a-variable-to-specific-values-diff-operator">
<h4><span class="section-number">4.5.2.9. </span>Set the change in a variable to specific values (=diff operator)<a class="headerlink" href="#set-the-change-in-a-variable-to-specific-values-diff-operator" title="Permalink to this headline">#</a></h4>
<p><span class="math notranslate nohighlight">\(\Delta = var_t - var_{t-1} = some number\)</span></p>
<p>Here sets the value of A in 2021 to 2 more than the value of 2020, and the 2022 value as 4 more than the <strong>revised</strong> value of 2021.</p>
<p>The second line creates a new variable “UPBY2” to the data frame and sets it equal to 100 for all periods,</p>
<p>The third line adds 2 to the previous periods value UPBY2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt; 2021 2022&gt; A =diff  2 4   # Same number of values as years</span>
<span class="s1">&lt;2020 &gt; UpBy2 = 100 # sets rows equal to the same  number for all years in between start and end </span>
<span class="s1">&lt;2021 2025&gt; UpBy2 =diff  2  </span>

<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>A</th>
      <th>UPBY2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>2.0</td>
      <td>102.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>6.0</td>
      <td>104.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
      <td>0.0</td>
      <td>106.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
      <td>0.0</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
      <td>0.0</td>
      <td>110.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="update-several-variable-in-one-line">
<h4><span class="section-number">4.5.2.10. </span>Update several variable in one line<a class="headerlink" href="#update-several-variable-in-one-line" title="Permalink to this headline">#</a></h4>
<p>Sometime there is a need to update several variable with the same value over the same time frame. To ease this case .update can accept several variables in one line</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2022 2024&gt; h i j k =      40      # earlier values are set to zero by default</span>
<span class="s1">&lt;2020&gt;      p q r s =       1000   # All values beginning in 2020 set to 1000</span>
<span class="s1">&lt;2021 -1&gt;   p q r s =growth 2      # -1 indicates the last year of dataframe</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
      <th>H</th>
      <th>I</th>
      <th>J</th>
      <th>K</th>
      <th>P</th>
      <th>Q</th>
      <th>R</th>
      <th>S</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall we have not overwritten df, so the df dataframe is unchanged.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>1</td>
      <td>8</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>1</td>
      <td>9</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> only operates on one variable.  A command like <code class="docutils literal notranslate"><span class="pre">.upd('A</span> <span class="pre">=</span> <span class="pre">B')</span></code> would not work. For these kind of functions, use <code class="docutils literal notranslate"><span class="pre">.mfcalc()</span></code> (see next section).</p>
</div>
</section>
</section>
<section id="selected-upd-options">
<h3><span class="section-number">4.5.3. </span>Selected <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> options<a class="headerlink" href="#selected-upd-options" title="Permalink to this headline">#</a></h3>
<section id="the-keep-growth-option-kg-and-nkg">
<h4><span class="section-number">4.5.3.1. </span>The keep_growth option (–kg and –nkg)<a class="headerlink" href="#the-keep-growth-option-kg-and-nkg" title="Permalink to this headline">#</a></h4>
<p>When changing data and for certain kinds of simulations, it can sometime be useful to be able to update variables but keep the growth rate in subsequent periods unchanged. In database management this is frequently done when two time-series with different levels are spliced together. When forecasting this is useful if you have updated historical data but your views on future growth rates are unchanged.</p>
<p>The -kg or –keep_growth option instructs modelflow to calculate the growth rate of the existing pre-change series, and then use it to preserve the pre-change growth rates of the series for the periods that were <strong>not</strong> changed.</p>
<section id="the-default-keep-growth-behaviour">
<h5><span class="section-number">4.5.3.1.1. </span>The default keep_growth behaviour<a class="headerlink" href="#the-default-keep-growth-behaviour" title="Permalink to this headline">#</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> option determines how data in  the time periods after those where an update is executed are treated.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> then data in the sub-period after a change is left unchanged.</p>
<p>if <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is set to “<code class="docutils literal notranslate"><span class="pre">True</span></code>” then the system will preserve the pre-change growth rate of the affected variable in the time period <em>after the change</em>.</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the line level:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code> can be expressed as –kg</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code> can be expressed as –nkg</p></li>
</ul>
</div>
<p>Consider the followingconcrete example. A <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> df has two variables A and B, that each grow by 2% per period, with A initialized at a level of 100 and B at a level of 110 so that we can see each separately on a graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2025</span><span class="p">)],</span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">])</span> 

<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;2021 -1&gt; A =growth 2</span>
<span class="s2">           &lt;2020 -1&gt;   B = 110</span>
<span class="s2">          &lt;2021 -1&gt;    B =growth 2</span>
<span class="s2">          &quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Store these variables for later use in comparisons</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;A_ORIG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;B_ORIG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>104.040000</td>
      <td>114.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>106.120800</td>
      <td>116.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>108.243216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/374953e85d0c2e2763f3012854dd4d5f6efeca46538348600dc4a9e85d654583.png" src="../../_images/374953e85d0c2e2763f3012854dd4d5f6efeca46538348600dc4a9e85d654583.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> command below modifies both A and B by adding 5 to their levels in each of 2022 and 2023.</p>
<p>For A, this is done with the <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> option set to <code class="docutils literal notranslate"><span class="pre">True</span></code> – the <code class="docutils literal notranslate"><span class="pre">--kg</span></code> option in the code below.  This means that for A the growth rate after the shock period 2022-23 will be unchanged at 2 percent.</p>
<p>For series B the same shock is applied but with keep_growth set to <code class="docutils literal notranslate"><span class="pre">False</span></code> using the –nkg option.</p>
<p>The keep_growth global variable is ignored in this instance as each line in the update is overriding it using the –kg option (<code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code>) and –nkg option (<code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;2022 2023&gt; A + 5 --kg</span>
<span class="s2">            &lt;2022 2023&gt; B + 5 --nkg</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A_ORIG&#39;</span><span class="p">,</span><span class="s1">&#39;B_ORIG&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/2254b41aab36e7081f298729b7d3db88157168e2e725110a0c601997174132ad.png" src="../../_images/2254b41aab36e7081f298729b7d3db88157168e2e725110a0c601997174132ad.png" />
</div>
</div>
<p>In the first example ‘A’ (the green and blue lines) the level of A is increased by 5 for two periods (2021-2022). The levels of the subsequent values are also increased because the previous growth rate (2%) is now applied to the new higher level of the data in 2022.</p>
<p>For the ‘B’ variable the same level change was input but because of the <code class="docutils literal notranslate"><span class="pre">--nkg</span></code> (equivalent to <code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code>) the periods after the change were unaffected. the shocked variable returns to its pre-shock level immediately in 2023.</p>
<p>Below are plots the growth rates of the two transformed series.</p>
<p>Here the growth in both series accelerates in 2022, by slightly less than 5 percentage points because a) the base of each is more than 100 in 2021 (because of the 2 percent growth in 2021). Substantially more in the case of  B, which was initialized at 110. In 2023 the growth rate of A returns to 2 percent, while the growth rate of B is actually negative because the level (see earlier graph) has fallen back to its original level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfg</span><span class="o">=</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
<span class="n">dfg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/9622d660dd9cc89d3f08f398ab116fb02810a34acc1e66b3cd362a663b1f017d.png" src="../../_images/9622d660dd9cc89d3f08f398ab116fb02810a34acc1e66b3cd362a663b1f017d.png" />
</div>
</div>
</section>
</section>
<section id="upd-keep-growth-some-more-examples">
<h4><span class="section-number">4.5.3.2. </span>.upd(,,,keep_growth) some more examples<a class="headerlink" href="#upd-keep-growth-some-more-examples" title="Permalink to this headline">#</a></h4>
<p>Initialize a new dataframe, with some growth rate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># instantiate a new dataframe with one column &#39;A&#39; with avlue 100 everywhere and index 2020-2025</span>
<span class="n">dftest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2026</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>                                 <span class="c1"># create column name</span>
<span class="n">dftest</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update a to have growth rate accelerationg linearly by 1 from 1 oercent to 5 percent</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">dftest</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&lt;2021 2025&gt; a =growth 1 2 3 4 5&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Levels:</span><span class="se">\n</span><span class="si">{</span><span class="n">original</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">original</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levels:
               A
2020  100.000000
2021  101.000000
2022  103.020000
2023  106.110600
2024  110.355024
2025  115.872775

Growth:
        A
2020  NaN
2021  1.0
2022  2.0
2023  3.0
2024  4.0
2025  5.0
</pre></div>
</div>
</div>
</div>
<p><strong>Now update A in 2021 to 2023 to a new value</strong></p>
<p>Below performs the same operation twice, the first time the updated value is assigned to the <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> <code class="docutils literal notranslate"><span class="pre">nkg</span></code> and the default behaviour of <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>In the second example the <code class="docutils literal notranslate"><span class="pre">-kg</span></code> line option is specified, telling modelflow to maintain the growth rates of the dependent variable in the periods after the update is executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nokg</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2025&gt;  a =growth 1 2 3 4 5 </span>
<span class="s1">&lt;2021 2023&gt;  a = 120  </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">kg</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2025&gt;  a =growth 1 2 3 4 5 </span>
<span class="s1">&lt;2021 2023&gt;  a = 120  --kg</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="n">kg</span><span class="o">=</span><span class="n">kg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span><span class="s2">&quot;KG&quot;</span><span class="p">})</span>       <span class="c1">#rename cols to facilitate display</span>
<span class="n">nokg</span><span class="o">=</span><span class="n">nokg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span><span class="s2">&quot;NOKG&quot;</span><span class="p">})</span> <span class="c1">#rename cols to facilitate display</span>
<span class="n">df</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span><span class="s2">&quot;Orig&quot;</span><span class="p">})</span> <span class="c1">#rename cols to facilitate display</span>

<span class="n">combo</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">kg</span><span class="p">,</span><span class="n">nokg</span><span class="p">,</span><span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">combo</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Levels</span><span class="se">\n</span><span class="si">{</span><span class="n">combo</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth</span><span class="se">\n</span><span class="si">{</span><span class="n">combo</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levels
          KG        NOKG        Orig
2020  100.00  100.000000  100.000000
2021  120.00  120.000000  101.000000
2022  120.00  120.000000  103.020000
2023  120.00  120.000000  106.110600
2024  124.80  110.355024  110.355024
2025  131.04  115.872775  115.872775

Growth
        KG      NOKG  Orig
2020   NaN       NaN   NaN
2021  20.0  20.00000   1.0
2022   0.0   0.00000   2.0
2023   0.0   0.00000   3.0
2024   4.0  -8.03748   4.0
2025   5.0   5.00000   5.0
</pre></div>
</div>
</div>
</div>
<p><strong>Understanding the results</strong></p>
<p>In the first example where KG (keep_growth) <strong>was set</strong>, the level was set constant for three periods at 120 the rate of growth was 0 for the final two years of the set period.  But following this update, the level of A in 2023 is 120. With <code class="docutils literal notranslate"><span class="pre">keep_Growth=True</span></code> the KG variable growth at 2 percent per year in 2024 and 2025.</p>
<p>In the <strong>–nkg</strong> example, the levels of NOKG are the same as KG for 2020 through 2023, but because <code class="docutils literal notranslate"><span class="pre">--nkg</span></code> was selected the levels revert to their pre-shock values, which are lower than the 120 in 2023.  As a result the growth rate for NOKG is negative in 2024. The growth rate for 2024 remains 5 because neither the 2024 or 2025 data changed and therefore the 2025 the growth rate does not change.</p>
</section>
<section id="upd-with-the-option-keep-growth-set-globally">
<h4><span class="section-number">4.5.3.3. </span>.upd() with the option keep_growth set globally<a class="headerlink" href="#upd-with-the-option-keep-growth-set-globally" title="Permalink to this headline">#</a></h4>
<p>Above the line level option <code class="docutils literal notranslate"><span class="pre">--keep_growth</span></code> or <code class="docutils literal notranslate"><span class="pre">--kg</span></code> was used to keep the growth rate (or not) for a given operation.</p>
<p>This works because by default the option <code class="docutils literal notranslate"><span class="pre">Keep_growth</span></code> is set to false, implementing <code class="docutils literal notranslate"><span class="pre">--kg</span></code> at the line level temporarily set the keep_growth flag to  true for the specific line (and those following).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> flag can also be set globally for all the lines by setting the option in the command line.</p>
<p><code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code>.</p>
<p>Now as default, all lines will keep the growth rate (unless overridden at the line level with <code class="docutils literal notranslate"><span class="pre">--nkg</span></code> or <code class="docutils literal notranslate"><span class="pre">--no_keep_growth</span></code>.</p>
<ul class="simple">
<li><p>c,d are updated in 2022 and 2023 and keep the growth rates afterwards</p></li>
<li><p>e the <code class="docutils literal notranslate"><span class="pre">--no_keep_growth</span></code> in this line prevents the updating 2024-2025</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a data frame</span>
<span class="n">dftest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2025</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>                                 <span class="c1"># create column name </span>
<span class="n">dftest</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfres</span> <span class="o">=</span> <span class="n">dftest</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2022 2023&gt; c = 200 </span>
<span class="s1">&lt;2022 2023&gt; d = 300  </span>
<span class="s1">&lt;2022 2023&gt; e = 400  --no_keep_growth </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">keep_growth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># &lt;=  Set keep_growth to True for the entirety of the command, </span>
                       <span class="c1"># except for e where it is overridden by the --no_keep_growth flag</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">dfres</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">dfres</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
        A    B      C      D    E
2020  100  100  100.0  100.0  100
2021  100  100  100.0  100.0  100
2022  100  100  200.0  300.0  400
2023  100  100  200.0  300.0  400
2024  100  100  200.0  300.0  100

Growth:
        A    B      C      D      E
2020  NaN  NaN    NaN    NaN    NaN
2021  0.0  0.0    0.0    0.0    0.0
2022  0.0  0.0  100.0  200.0  300.0
2023  0.0  0.0    0.0    0.0    0.0
2024  0.0  0.0    0.0    0.0  -75.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="upd-scale-number-default-1-scale-the-updates">
<h4><span class="section-number">4.5.3.4. </span>.upd(,,scale=&lt;number, default=1&gt;) Scale the updates<a class="headerlink" href="#upd-scale-number-default-1-scale-the-updates" title="Permalink to this headline">#</a></h4>
<p>When running scenarios it can be useful to sensitivity analyses of model results, to better understand how the model responds when varying the intensity of a shock.</p>
<p>The scale option provides a mechanism for calculating a range shocks as a proportion of the initially indicated one.</p>
<p>When using the scale option, scale=0 implies no change (effectively the baseline) while scale=0.5 is a scenario half of the full severity.</p>
<p>In the example below <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> is executed three times for severity equals 0. 0.5 and 1.  If the list passed to scale (named severity in this case) had five items in it, the update would be run five times – one time for each item in the list.</p>
<p>This example just prints outputs, a more interesting example would involve the solving a model using different levels of a given shock.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;input dataframe: </span><span class="se">\n</span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span> 
    <span class="c1"># First make a dataframe with some growth rate </span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;2021 2025&gt;</span>
<span class="s1">    a =growth 1 2 3 4 5 </span>
<span class="s1">    b + 10</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">severity</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">severity</span><span class="si">=}</span><span class="se">\n</span><span class="s1">Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#  </span>
    <span class="c1"># Here the updated dataframe is only printed. </span>
    <span class="c1"># A more realistic use case is to simulate a model like this: </span>
    <span class="c1"># dummy_ = mpak(res,keep=&#39;Severity {serverity}&#39;)    # more realistic </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>input dataframe: 
            Orig
2020  100.000000
2021  101.000000
2022  103.020000
2023  106.110600
2024  110.355024
2025  115.872775


severity=0
Dataframe:
            Orig    A    B
2020  100.000000  0.0  0.0
2021  101.000000  0.0  0.0
2022  103.020000  0.0  0.0
2023  106.110600  0.0  0.0
2024  110.355024  0.0  0.0
2025  115.872775  0.0  0.0

Growth:
      Orig   A   B
2020   NaN NaN NaN
2021   1.0 NaN NaN
2022   2.0 NaN NaN
2023   3.0 NaN NaN
2024   4.0 NaN NaN
2025   5.0 NaN NaN


severity=0.5
Dataframe:
            Orig    A    B
2020  100.000000  0.0  0.0
2021  101.000000  0.0  5.0
2022  103.020000  0.0  5.0
2023  106.110600  0.0  5.0
2024  110.355024  0.0  5.0
2025  115.872775  0.0  5.0

Growth:
      Orig   A    B
2020   NaN NaN  NaN
2021   1.0 NaN  inf
2022   2.0 NaN  0.0
2023   3.0 NaN  0.0
2024   4.0 NaN  0.0
2025   5.0 NaN  0.0


severity=1
Dataframe:
            Orig    A     B
2020  100.000000  0.0   0.0
2021  101.000000  0.0  10.0
2022  103.020000  0.0  10.0
2023  106.110600  0.0  10.0
2024  110.355024  0.0  10.0
2025  115.872775  0.0  10.0

Growth:
      Orig   A    B
2020   NaN NaN  NaN
2021   1.0 NaN  inf
2022   2.0 NaN  0.0
2023   3.0 NaN  0.0
2024   4.0 NaN  0.0
2025   5.0 NaN  0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="upd-lprint-true-prints-values-the-before-and-after-update">
<h4><span class="section-number">4.5.3.5. </span>.upd(,,lprint=True ) prints values the before and after update<a class="headerlink" href="#upd-lprint-true-prints-values-the-before-and-after-update" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">lPrint</span></code> option of the method <code class="docutils literal notranslate"><span class="pre">upd()</span></code> is set to <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">False</span></code> by default.  By setting it true, an update command will output the results of the calculation comparing the values of the dataframe (over the impacted period) before, after and the difference between the two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2022&gt; A *  42 44</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Update * [42.0, 44.0] 2021 2022
A                    Before                After                 Diff
2021                 0.0000               0.0000               0.0000
2022                 0.0000               0.0000               0.0000
</pre></div>
</div>
</div>
</div>
</section>
<section id="upd-create-true-requires-the-variable-to-exist">
<h4><span class="section-number">4.5.3.6. </span>.upd(,,create=True ) Requires the variable to exist<a class="headerlink" href="#upd-create-true-requires-the-variable-to-exist" title="Permalink to this headline">#</a></h4>
<p>Until now .upd has created variables if they did not exist in the input dataframe.</p>
<p>To catch misspellings the parameter <code class="docutils literal notranslate"><span class="pre">create</span></code> can be set to False.
New variables will not be created, and an exception will be raised.</p>
<p>Here Pythons exception handling is used, so the notebook will continue to run the cells below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    # Same number of values as years</span>
<span class="s1">    &lt;2021 2022&gt; Aa *  42 44</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span><span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable to update not found:AA, timespan = [2021 2022] 
Set create=True if you want the variable created: 
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content\04_PythonEssentials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="PythonPandasDataframes.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Some Python basics</p>
      </div>
    </a>
    <a class="right-next"
       href="mfcalc.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4.6. </span><code class="docutils literal notranslate"><span class="pre">.mfcalc()</span></code> an extension of standard Pandas</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-python-environment">4.1. Setting up the python environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#column-names-in-modelflow">4.2. Column names in  Modelflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#index-and-time-dimensions-in-modelflow">4.3. .index and time dimensions in Modelflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leads-and-lags">4.4. Leads and lags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-method-of-modelflow">4.5. .upd() method of modelflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-method-operators">4.5.1. <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-some-examples">4.5.2. <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> some examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-upd-to-create-a-new-variable-operator">4.5.2.1. Use .upd to create a new variable (= operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-updates-and-specific-time-periods">4.5.2.2. Multiple updates and specific time periods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-specific-datapoints-to-specific-values">4.5.2.3. Setting specific datapoints to specific values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator">4.5.2.4. Adding  the specified  values to all values in a range (the + operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator">4.5.2.5. Multiplying all values in a range by the specified values (the * operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">4.5.2.6. Increasing all  values in a range by a  specified percent amount (the % operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-percent-growth-rate-to-specified-values-growth">4.5.2.7. Set the percent growth rate to specified values (=GROWTH)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">4.5.2.8. Add or subtract from the existing percent growth rate (+GROWTH operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-change-in-a-variable-to-specific-values-diff-operator">4.5.2.9. Set the change in a variable to specific values (=diff operator)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#update-several-variable-in-one-line">4.5.2.10. Update several variable in one line</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selected-upd-options">4.5.3. Selected <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> options</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-keep-growth-option-kg-and-nkg">4.5.3.1. The keep_growth option (–kg and –nkg)</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#the-default-keep-growth-behaviour">4.5.3.1.1. The default keep_growth behaviour</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-keep-growth-some-more-examples">4.5.3.2. .upd(,,,keep_growth) some more examples</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-with-the-option-keep-growth-set-globally">4.5.3.3. .upd() with the option keep_growth set globally</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-scale-number-default-1-scale-the-updates">4.5.3.4. .upd(,,scale=&lt;number, default=1&gt;) Scale the updates</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-lprint-true-prints-values-the-before-and-after-update">4.5.3.5. .upd(,,lprint=True ) prints values the before and after update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upd-create-true-requires-the-variable-to-exist">4.5.3.6. .upd(,,create=True ) Requires the variable to exist</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andrew Burns and Ib Hansen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright World Bank. 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>