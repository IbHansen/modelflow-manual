
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Extend Pandas dataframes with ModelFLow capabilities. &#8212; MFMod models in Python with ModelFlow</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="8. Create a small model from scratch and save it" href="../smallmodel/modelstart.html" />
    <link rel="prev" title="6. Update, modifying series in a dataframe using modelflow" href="model%20update.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">MFMod models in Python with ModelFlow</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Model, solutions and Modelflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/model%20and%20solution.html">
   1. What is a Model in ModelFlow ?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/Example%20Solow.html">
   3. Example Solow model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python and pandas stuff
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/Intro_Jupyter_notebook.html">
   4. Introduction to the Jupyter Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/pandas/dataframes.html">
   5. Introduction to Pandas dataframes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Updating variables
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="model%20update.html">
   6. Update, modifying series in a dataframe using modelflow
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   7. Extend Pandas dataframes with ModelFLow capabilities.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  A small demo model
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../smallmodel/modelstart.html">
   8. Create a small model from scratch and save it
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../smallmodel/modelstart%20export%20up.html">
   9. Experiment: Export up
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Make experiments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_experiment.html">
   10. Create an experiment, simulate it and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_save_scenarios.html">
   12. Create many scenarios, simulate them  and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/Standard%20experiment%20simple.html">
   13. A experiment using Taxes on Goods and Services
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Keept experiments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../keep/Create%20and%20modify%20charts%20with%20keep_plot.html">
   14. Load a model and data inclusive the keept scenarios
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Onboarding MFMod models from .wf1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20one%20model%20from%20%20wf1.html">
   15. Onboard a model defined in a .wf1 file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20many%20models%20from%20wf1.html">
   16. Onboard all models  defined in .wf1 files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/Normalizing%20when%20onboarding%20eviews.html">
   17. Normalizing when onboarding  eviews models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  modifying models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fixing/Fixing%20variables.html">
   18. Fixing the value of variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../modifymodel/create_real_model.html">
   19. Modified equation to to keep real tax rates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Features
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/modelflow_features.html">
   21. Useful model instance properties and methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Structure
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../structure/Logical_structure.html">
   22. Logical structure and dependencies.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution/Attribution%20background.html">
   23. Attribution
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Target and instruments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../targetinstruments/One%20target%20one%20instrument%20with%203%20instrument%20variables.html">
   24. One target one instrument with 3 instrument variables
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Specification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/model%20specification.html">
   25. Specification of models (introduction)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../optimization/Optimize_simpel.html">
   26. Mean variance optimization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  More
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../litterature.html">
   27. Litterature
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/IbHansen/modelflow-manual/main?urlpath=tree/papers/mfbook/content/howto/update/extending_dataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/IbHansen/modelflow-manual/blob/main/papers/mfbook/content/howto/update/extending_dataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/IbHansen/modelflow-manual"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/content/howto/update/extending_dataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   7.1. Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-experiment">
   7.2. Set up experiment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-simple-dataframe">
     7.2.1. Create a  simple dataframe
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-mfcalc-to-calculate-a-new-column-series-as-a-function-of-the-existing-a-column-series">
     7.2.2. Use  mfcalc to calculate a new column (series) as a function of the existing A column series
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recalculate-a-so-it-grows-by-2-percent">
     7.2.3. Recalculate A so  it grows by 2 percent
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mfcalc-does-simple-normalizations">
     7.2.4. mfcalc does simple normalizations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-diff-delta-with-mfcalc">
     7.2.5. Using .diff (
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     ) with mfcalc
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mfcalc-with-several-equations-and-arguments">
     7.2.6. mfcalc with several equations and arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-a-time-frame-with-mfcalc">
     7.2.7. Setting a time frame with mfcalc.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mfcalc-usage">
   7.3. .mfcalc usage
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Extend Pandas dataframes with ModelFLow capabilities.</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   7.1. Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-experiment">
   7.2. Set up experiment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-simple-dataframe">
     7.2.1. Create a  simple dataframe
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-mfcalc-to-calculate-a-new-column-series-as-a-function-of-the-existing-a-column-series">
     7.2.2. Use  mfcalc to calculate a new column (series) as a function of the existing A column series
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recalculate-a-so-it-grows-by-2-percent">
     7.2.3. Recalculate A so  it grows by 2 percent
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mfcalc-does-simple-normalizations">
     7.2.4. mfcalc does simple normalizations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-diff-delta-with-mfcalc">
     7.2.5. Using .diff (
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     ) with mfcalc
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mfcalc-with-several-equations-and-arguments">
     7.2.6. mfcalc with several equations and arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-a-time-frame-with-mfcalc">
     7.2.7. Setting a time frame with mfcalc.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mfcalc-usage">
   7.3. .mfcalc usage
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="extend-pandas-dataframes-with-modelflow-capabilities">
<h1><span class="section-number">7. </span>Extend Pandas dataframes with ModelFLow capabilities.<a class="headerlink" href="#extend-pandas-dataframes-with-modelflow-capabilities" title="Permalink to this headline">#</a></h1>
<p>This Jupyter notebook show how ModelFlow can extend pandas dataframes to run models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I would find a home for this which is more general concerning modelflow /Ib</p>
<p>Modelflow is a library based on the needs of Economists in particular. Economists often work with time series and want to make calculations based on the time indexed values of a number of variables.</p>
<p>For example we may say that</p>
<p><span class="math notranslate nohighlight">\(\hat p_t = \hat p^e_{t}+  \alpha * (Y_t/Y^{pot}_t -1) + \beta *  (\hat p_{t-1}- \hat p^e_{t-1})\)</span></p>
<p>The inflation rate (<span class="math notranslate nohighlight">\(\hat p_t\)</span>) in time t is a function of expected inflation (<span class="math notranslate nohighlight">\(p^e_{t}\)</span>), the output gap <span class="math notranslate nohighlight">\((Y_t/Y^{pot}_t -1)\)</span> and the one period earlier difference between the inflation rate and expected inflation  <span class="math notranslate nohighlight">\(\hat p_{t-1}\)</span></p>
<p>Or we may want to have a system of simultaneous equations that allow for circular references, such that</p>
<p><span class="math notranslate nohighlight">\(Y_t = C_t +I_t +G_t +X_t - M_t\)</span></p>
<p><span class="math notranslate nohighlight">\(C_t= f(Y_t)\)</span></p>
<p><span class="math notranslate nohighlight">\(I_t= f(Y_t)\)</span></p>
<p><span class="math notranslate nohighlight">\(M_t= f(C_t,I_t)\)</span></p>
</div>
<section id="imports">
<h2><span class="section-number">7.1. </span>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>  <span class="c1"># Python data science library</span>
<span class="kn">import</span> <span class="nn">modelmf</span>       <span class="c1"># Add useful features to pandas dataframes </span>
                     <span class="c1"># using utlities initially developed for modelflow</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-experiment">
<h2><span class="section-number">7.2. </span>Set up experiment<a class="headerlink" href="#set-up-experiment" title="Permalink to this headline">#</a></h2>
<section id="create-a-simple-dataframe">
<h3><span class="section-number">7.2.1. </span>Create a  simple dataframe<a class="headerlink" href="#create-a-simple-dataframe" title="Permalink to this headline">#</a></h3>
<p>Create a Pandas dataframe with one column with the name A and 6 rows.</p>
<p>Set set the index to 2020 through 2026 and set the values of all the cells to 100.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> creates a dataframe  <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame">Description</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[2020+v</span> <span class="pre">for</span> <span class="pre">v</span> <span class="pre">in</span> <span class="pre">range(2020,2026)]</span></code> defines a python list comprehension which creates a list of the integers from 2020 to 2025</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>                                 <span class="c1"># call the dataframe constructure </span>
    <span class="mf">100.000</span><span class="p">,</span>                                           <span class="c1"># the values </span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2026</span><span class="p">)],</span>           <span class="c1">#index</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>                                  <span class="c1"># the column name </span>
                 <span class="p">)</span>
<span class="n">df</span>   <span class="c1"># the result of the last statement is displayed in the output cell </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="use-mfcalc-to-calculate-a-new-column-series-as-a-function-of-the-existing-a-column-series">
<h3><span class="section-number">7.2.2. </span>Use  mfcalc to calculate a new column (series) as a function of the existing A column series<a class="headerlink" href="#use-mfcalc-to-calculate-a-new-column-series-as-a-function-of-the-existing-a-column-series" title="Permalink to this headline">#</a></h3>
<p>X is a new column. Before it is calculated it is initialized to 0.0 for all years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;x = x(-1) + a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100.0</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100.0</td>
      <td>300.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100.0</td>
      <td>400.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100.0</td>
      <td>500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the above example a  dataframe with the result is created and displayed, but the df dataframe did not change.  To have it change we would have had to assign it the result of the initial operation, as below.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;x = x(-1) + a&#39;</span><span class="p">)</span> <span class="c1"># Assign the result to df2</span>
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100.0</td>
      <td>200.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100.0</td>
      <td>300.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100.0</td>
      <td>400.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100.0</td>
      <td>500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="recalculate-a-so-it-grows-by-2-percent">
<h3><span class="section-number">7.2.3. </span>Recalculate A so  it grows by 2 percent<a class="headerlink" href="#recalculate-a-so-it-grows-by-2-percent" title="Permalink to this headline">#</a></h3>
<p>mfcalcs knows that it can not start to calculate in 2020 as there is no lagged variable. So it will start calculating in 2021 and leave the pre-existing value unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;a =  1.02 *  a(-1)&#39;</span><span class="p">)</span>
<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>104.040000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>106.120800</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>108.243216</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>110.408080</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="c1"># to display the percent changes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><span style='color:Blue'> ORIGINAL </span></p>
</section>
<section id="mfcalc-does-simple-normalizations">
<h3><span class="section-number">7.2.4. </span>mfcalc does simple normalizations<a class="headerlink" href="#mfcalc-does-simple-normalizations" title="Permalink to this headline">#</a></h3>
<p>Another way to set the growth rate of a variable by setting the difference in its natural logarithm.</p>
<p>Here  dlog(a) refers to the differene in the natural logarithm and is equal to the growth rate for the variable.</p>
<blockquote>
<div><p>dlog(x) translates to  (<span class="math notranslate nohighlight">\(log(x_t)-log(x_{t-1}))\)</span></p>
</div></blockquote>
<p>In the current example dlog(a) is not defined for 2020 (there is no lagged value for 2019) so the 2020 value is left unchanged.</p>
<p>For 2021 2025 mfcalc normalizes the equation such that the systems solves for a:<br>
<span class="math notranslate nohighlight">\(dlog(a)  = 0.02\)</span> <br>
<span class="math notranslate nohighlight">\(log(a)-log(a_{t-1}) = .02\)</span><br>
<span class="math notranslate nohighlight">\(log(a)=log(a_{t-1})+.02\)</span> <br>
<span class="math notranslate nohighlight">\(a = e^{log(a_{t-1})+0.02}\)</span> <br>
<span class="math notranslate nohighlight">\(a =a_{t-1}*e^{0.02}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;dlog( a) =  0.02&#39;</span><span class="p">,</span><span class="n">showeq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FRML &lt;&gt; A=EXP(LOG(A(-1))+0.02)$
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>2.020134</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>2.020134</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>2.020134</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>2.020134</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>2.020134</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="using-diff-delta-with-mfcalc">
<h3><span class="section-number">7.2.5. </span>Using .diff (<span class="math notranslate nohighlight">\(\Delta\)</span>) with mfcalc<a class="headerlink" href="#using-diff-delta-with-mfcalc" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;diff(a) =  2&#39;</span><span class="p">)</span> <span class="c1"># Set delta to 2 </span>
<span class="n">res</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>                      <span class="c1"># Display the delta </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="mfcalc-with-several-equations-and-arguments">
<h3><span class="section-number">7.2.6. </span>mfcalc with several equations and arguments<a class="headerlink" href="#mfcalc-with-several-equations-and-arguments" title="Permalink to this headline">#</a></h3>
<p>In addition to a single equation multiple commands can be executed with one command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">diff(a) =  2</span>
<span class="s1">x = a + 42 </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">res</span>

<span class="c1"># use res.diff() to see the difference</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.0</td>
      <td>144.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>104.0</td>
      <td>146.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>106.0</td>
      <td>148.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>108.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>110.0</td>
      <td>152.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Take care. As the max lag is 1 the expressions will not be calculated for 2020. So A keeps its
value of 100 in 2020 and X is initialized to 0 before calculating. And then keeps the value of 0
for 2020, as 2020 is not calculated.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below, as in the example above we have zeroes for x prior to 2023 when the expressions are executed.</p>
<p><mark> Ib, Is this  because you returns zeroes by default for a declared variable? As the command was not exected for the earlier period, NaNs for nissing might be more logical.</mark></p>
<p><mark> From Ib, Is this  because you returns zeroes by default for a declared variable? Yes. It will require some efford as some functionalities depend on this, for instance when equations are enriched with with add factors and exogenizing.</p>
</div>
</section>
<section id="setting-a-time-frame-with-mfcalc">
<h3><span class="section-number">7.2.7. </span>Setting a time frame with mfcalc.<a class="headerlink" href="#setting-a-time-frame-with-mfcalc" title="Permalink to this headline">#</a></h3>
<p>It can useful in some circumstances to limit the time frame for which the calculations are performed. By specifying a start date and end date enclosed in &lt;&gt; in a  line we can restrict the time period over which calculation is performed.</p>
<p>Below, as in the example above we have zeroes for x prior to 2023 when the expressions are executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mfcalc</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2023 2025&gt;</span>
<span class="s1">diff(a) =  2</span>
<span class="s1">x = a + 42 </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">res</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>102.0</td>
      <td>144.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>104.0</td>
      <td>146.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>106.0</td>
      <td>148.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="mfcalc-usage">
<h2><span class="section-number">7.3. </span>.mfcalc usage<a class="headerlink" href="#mfcalc-usage" title="Permalink to this headline">#</a></h2>
<p>.mfcalc can be a useful extension to dataframe.upd() when creating scenarios. Or just for simple and fast calculations.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content\howto\update"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="model%20update.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">6. </span>Update, modifying series in a dataframe using modelflow</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../smallmodel/modelstart.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Create a small model from scratch and save it</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ib Hansen<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>