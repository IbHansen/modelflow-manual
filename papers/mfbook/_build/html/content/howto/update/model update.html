
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>10. Modelflows extensions to pandas &#8212; MFMod models in Python with ModelFlow</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="11. .mfcalc() an extension of standard Pandas" href="extending_dataframes.html" />
    <link rel="prev" title="7. Some Python basics" href="../../notebooks/PythonPackagesEtc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">MFMod models in Python with ModelFlow</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Macrostructural Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../MacroStructuralModels.html">
   1. Macrostructural models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../MFModAndModelFlow.html">
   2. Modelflow and the MFMod models of the World Bank
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installation of modelflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Installation/InstallingPython.html">
   3. Installation of Modelflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Installation/InstallingModelFlow.html">
   4. Installation of Modelflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Installation/TestingModelFlow.html">
   5. Testing your installation of modelflow
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Some Jupyter, Python and pandas essentials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/Intro_Jupyter_notebook.html">
   6. Introduction to  Jupyter Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/PythonPackagesEtc.html">
   7. Some Python basics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Modeflflow extensions to pandas
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   10. Modelflows extensions to pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="extending_dataframes.html">
   11.
   <code class="docutils literal notranslate">
    <span class="pre">
     .mfcalc()
    </span>
   </code>
   an extension of standard Pandas
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Make experiments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_experiment.html">
   12. Create an experiment, simulate it and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_save_scenarios.html">
   14. Create many scenarios, simulate them  and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/Standard%20experiment%20simple.html">
   15. A experiment using Taxes on Goods and Services
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Kept scenarios
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../keep/Create%20and%20modify%20charts%20with%20keep_plot.html">
   16. Load a model and data inclusive the keept scenarios
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Onboarding MFMod models from .wf1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20one%20model%20from%20%20wf1.html">
   17. Onboard a model defined in a .wf1 file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20many%20models%20from%20wf1.html">
   18. Onboard all models  defined in .wf1 files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/Normalizing%20when%20onboarding%20eviews.html">
   19. Normalizing when onboarding  eviews models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  modifying models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fixing/Fixing%20variables.html">
   20. Fixing the value of variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../modifymodel/create_real_model.html">
   21. Modified equation to to keep real tax rates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Features
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/modelflow_features.html">
   23. Useful model instance properties and methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Structure
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../structure/Logical_structure.html">
   24. Logical structure and dependencies.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution/Attribution%20background.html">
   25. Attribution
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Target and instruments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../targetinstruments/One%20target%20one%20instrument%20with%203%20instrument%20variables.html">
   26. One target one instrument with 3 instrument variables
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Specification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/model%20specification.html">
   27. Specification of models (introduction)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  More
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../litterature.html">
   28. Litterature
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/howto/update/model update.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/IbHansen/modelflow-manual"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/IbHansen/modelflow-manual/main?urlpath=tree/papers/mfbook/content/howto/update/model update.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/IbHansen/modelflow-manual/blob/main/papers/mfbook/content/howto/update/model update.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-method-of-modelflow">
   10.1. .upd() method of modelflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#upd-method-operators">
     10.1.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       .upd()
      </span>
     </code>
     method operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-some-examples">
   10.2.
   <code class="docutils literal notranslate">
    <span class="pre">
     .upd()
    </span>
   </code>
   some examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-python-environment">
     10.2.1. Setting up the python environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-upd-to-create-a-new-variable-operator">
     10.2.2. Use .upd to create a new variable (= operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-updates-and-specific-time-periods">
     10.2.3. multiple updates and specific time periods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-specific-datapoints-to-specific-values">
       10.2.3.1. Setting specific datapoints to specific values
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator">
     10.2.4. Adding  the specified  values to all values in a range (the + operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator">
     10.2.5. Multiplying all values in a range by the specified values (the * operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">
     10.2.6. Increasing all  values in a range by a  specified percent amount (the % operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-percent-growth-rate-to-specified-values-growth">
     10.2.7. Set the percent growth rate to specified values (=GROWTH)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">
     10.2.8. Add or subtract from the existing percent growth rate (+GROWTH operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-delta-var-t-var-t-1-to-specified-values-diff-operator">
     10.2.9. Set
     <span class="math notranslate nohighlight">
      \(\Delta = var_t - var_{t-1}\)
     </span>
     to specified values (=diff operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recall-that-we-have-not-overwritten-df-so-the-df-dataframe-is-unchanged">
     10.2.10. Recall  that we have not overwritten df, so the df dataframe is unchanged.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keep-growth-rates-after-the-update-time-the-kg-option">
     10.2.11. Keep growth rates after the update time – the –kg option
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-default-keep-growth-behaviour">
       10.2.11.1. The default keep_growth behaviour
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-keep-growth-some-more-examples">
   10.3. .upd(,,,keep_growth) some more examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-a-new-dataframe-first-make-a-dataframe-with-some-growth-rate">
     10.3.1. Initialize a new dataframe First make a dataframe with some growth rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-update-a-in-2021-to-2023-to-a-new-value">
     10.3.2. now update A in 2021 to 2023 to a new value
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#upd-with-the-option-keep-growth-set-globally">
       10.3.2.1. .upd() with the option keep_growth set globally
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-more-advanced-example">
     10.3.3. Some more advanced example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-create-a-string-with-update-lines">
       10.3.3.1. First create a string with update lines
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-the-update-lines-to-update-a-dataframe">
       10.3.3.2. Use the update lines to update a dataframe
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kg-can-replace-keep-growth-and-nkg-can-replace-non-keep-growth">
     10.3.4. –kg can replace –keep_growth and –nkg can replace –non_keep_growth
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#update-several-variable-in-one-line">
   10.4. Update several variable in one line
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-scale-number-default-1-scale-the-updates">
   10.5. .upd(,,scale=&lt;number, default=1&gt;) Scale the updates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-lprint-true-prints-values-the-before-and-after-update">
   10.6. .upd(,,lprint=True ) prints values the before and after update
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-create-true-requires-the-variable-to-exist">
   10.7. .upd(,,create=True ) Requires the variable to exist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-call">
   10.8. The call
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Modelflows extensions to pandas</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-method-of-modelflow">
   10.1. .upd() method of modelflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#upd-method-operators">
     10.1.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       .upd()
      </span>
     </code>
     method operators
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-some-examples">
   10.2.
   <code class="docutils literal notranslate">
    <span class="pre">
     .upd()
    </span>
   </code>
   some examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-python-environment">
     10.2.1. Setting up the python environment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-upd-to-create-a-new-variable-operator">
     10.2.2. Use .upd to create a new variable (= operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-updates-and-specific-time-periods">
     10.2.3. multiple updates and specific time periods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-specific-datapoints-to-specific-values">
       10.2.3.1. Setting specific datapoints to specific values
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator">
     10.2.4. Adding  the specified  values to all values in a range (the + operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator">
     10.2.5. Multiplying all values in a range by the specified values (the * operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">
     10.2.6. Increasing all  values in a range by a  specified percent amount (the % operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-percent-growth-rate-to-specified-values-growth">
     10.2.7. Set the percent growth rate to specified values (=GROWTH)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">
     10.2.8. Add or subtract from the existing percent growth rate (+GROWTH operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-delta-var-t-var-t-1-to-specified-values-diff-operator">
     10.2.9. Set
     <span class="math notranslate nohighlight">
      \(\Delta = var_t - var_{t-1}\)
     </span>
     to specified values (=diff operator)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recall-that-we-have-not-overwritten-df-so-the-df-dataframe-is-unchanged">
     10.2.10. Recall  that we have not overwritten df, so the df dataframe is unchanged.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keep-growth-rates-after-the-update-time-the-kg-option">
     10.2.11. Keep growth rates after the update time – the –kg option
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-default-keep-growth-behaviour">
       10.2.11.1. The default keep_growth behaviour
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-keep-growth-some-more-examples">
   10.3. .upd(,,,keep_growth) some more examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-a-new-dataframe-first-make-a-dataframe-with-some-growth-rate">
     10.3.1. Initialize a new dataframe First make a dataframe with some growth rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-update-a-in-2021-to-2023-to-a-new-value">
     10.3.2. now update A in 2021 to 2023 to a new value
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#upd-with-the-option-keep-growth-set-globally">
       10.3.2.1. .upd() with the option keep_growth set globally
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-more-advanced-example">
     10.3.3. Some more advanced example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-create-a-string-with-update-lines">
       10.3.3.1. First create a string with update lines
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-the-update-lines-to-update-a-dataframe">
       10.3.3.2. Use the update lines to update a dataframe
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kg-can-replace-keep-growth-and-nkg-can-replace-non-keep-growth">
     10.3.4. –kg can replace –keep_growth and –nkg can replace –non_keep_growth
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#update-several-variable-in-one-line">
   10.4. Update several variable in one line
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-scale-number-default-1-scale-the-updates">
   10.5. .upd(,,scale=&lt;number, default=1&gt;) Scale the updates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-lprint-true-prints-values-the-before-and-after-update">
   10.6. .upd(,,lprint=True ) prints values the before and after update
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upd-create-true-requires-the-variable-to-exist">
   10.7. .upd(,,create=True ) Requires the variable to exist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-call">
   10.8. The call
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="modelflows-extensions-to-pandas">
<h1><span class="section-number">10. </span>Modelflows extensions to pandas<a class="headerlink" href="#modelflows-extensions-to-pandas" title="Permalink to this headline">¶</a></h1>
<p>Modeflow inherits all the capabilities of pandas and extends some as well.</p>
<p>As we have seen above we can modify data in a dataframe directly with built-in pandas functionalities like <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>.</p>
<div class="section" id="upd-method-of-modelflow">
<h2><span class="section-number">10.1. </span>.upd() method of modelflow<a class="headerlink" href="#upd-method-of-modelflow" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method extends these capabilities in important ways.  It gives the user a concise and expressive way to modify data in a dataframe in the way that a user or database-manager of the World Bank MFMod models might.</p>
<p>Notably it allows us to employ formula’s to do updates, including lags and leads on variables.</p>
<p><code class="docutils literal notranslate"><span class="pre">.upd()</span></code>  be used to:</p>
<ul class="simple">
<li><p>Perform different types of  updates</p></li>
<li><p>Perform multiple updates each on a new line</p></li>
<li><p>Perform changes over specific periods</p></li>
<li><p>Use one input which is used for all time frames, or a input for each time</p></li>
<li><p>Preserve pre-shock growth rates for out of sample time-periods</p></li>
<li><p>Display results</p></li>
</ul>
<div class="section" id="upd-method-operators">
<h3><span class="section-number">10.1.1. </span><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method operators<a class="headerlink" href="#upd-method-operators" title="Permalink to this headline">¶</a></h3>
<p>Below are some of the operators that can be used in the <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> method</p>
<p><strong>Types of update:</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Update to perform</p></th>
<th class="text-align:left head"><p>Use this operator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Set a variable equal to the input</p></td>
<td class="text-align:left"><p>=</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Add the input to the input</p></td>
<td class="text-align:left"><p>+</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Set the variable to itself multiplied by the input</p></td>
<td class="text-align:left"><p>*</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Increase/Decrease the variable by a percent of itself (1+input/100)</p></td>
<td class="text-align:left"><p>%</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Set the growth rate of the variable to the input</p></td>
<td class="text-align:left"><p>=growth</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Change the growth rate of the variable to its current growth rate plus the input value in percentage points</p></td>
<td class="text-align:left"><p>+growth</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Specify the amount by which the variable should increase from its previous period level (<span class="math notranslate nohighlight">\(\Delta = var_t - var_{t-1}\)</span></p></td>
<td class="text-align:left"><p>=diff</p></td>
</tr>
</tbody>
</table>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Note: the syntax of an update command requires that there be a space between variable names and the operators.</p>
<p>Thus <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">=</span> <span class="pre">7&quot;)</span></code> is fine, but <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">=7&quot;)</span></code> will generate an error.</p>
<p>Similarly  <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A</span> <span class="pre">*</span> <span class="pre">1.1&quot;)</span></code> is fine, but <code class="docutils literal notranslate"><span class="pre">df.upd(&quot;A=*</span> <span class="pre">1.1&quot;)</span></code> will generate an error.</p>
</div>
</div>
</div>
<div class="section" id="upd-some-examples">
<h2><span class="section-number">10.2. </span><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> some examples<a class="headerlink" href="#upd-some-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-up-the-python-environment">
<h3><span class="section-number">10.2.1. </span>Setting up the python environment<a class="headerlink" href="#setting-up-the-python-environment" title="Permalink to this headline">¶</a></h3>
<p>In order to use <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> we need to first import all of the necessary libraries to out python session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="c1"># First we must import pandas as modelflow into ouir workspace</span>
<span class="c1"># There is no problem importing multiple times, though it is not very efficient.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">modelclass</span> <span class="kn">import</span> <span class="n">model</span> 
<span class="c1"># functions that improve rendering of modelflow outputs under Jupyter Notebook</span>
<span class="n">model</span><span class="o">.</span><span class="n">widescreen</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">scroll_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
    div#notebook-container    { width: 95%; }
    div#menubar-container     { width: 65%; }
    div#maintoolbar-container { width: 99%; }
</style>
</div></div>
</div>
<p>Now create a dataframe using standard pandas syntax.  In this instance with years as the index and a dictionary defining the variables and their data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dataframe using standard pandas</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;C&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="s1">&#39;E&#39;</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2018</span><span class="p">,</span><span class="mi">2019</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="mi">2021</span><span class="p">])</span>
<span class="n">df</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018</th>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>1</td>
      <td>6</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we want to be a bit more creative we could use a loop to create the dataframe for dates that we pass as an argument.  For example, below we create a dataframe df with two Series (A and B), which we initialize with the values 100 for all data points.</p>
<p>In this case we we define the index dynamically as the result of a loop <code class="docutils literal notranslate"><span class="pre">index=[2020+v</span> <span class="pre">for</span> <span class="pre">v</span> <span class="pre">in</span> <span class="pre">range(number_of_rows)]</span></code>.</p>
<p>This bit of code runs a loop that runs for number_of_rows times setting v equal to 2020+0, 2020+1,…,202+5. The resulting list whose values are assigned to index is [2020,2021,2022,2023,2024,2025].</p>
<p>The big advanatge of this method is that if the user wanted to have data created for the period 1990 to 2030, they would only have to change number_of_rows from 6 to 41 and 2020 in the loop to 1990.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#define the number of years for which the data is to be created.</span>
<span class="n">number_of_rows</span> <span class="o">=</span> <span class="mi">6</span> 

<span class="c1"># call the dataframe constructor</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="o">+</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_rows</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>                                 <span class="c1"># create column name </span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="use-upd-to-create-a-new-variable-operator">
<h3><span class="section-number">10.2.2. </span>Use .upd to create a new variable (= operator)<a class="headerlink" href="#use-upd-to-create-a-new-variable-operator" title="Permalink to this headline">¶</a></h3>
<p>We know from above that with pandas we can add a column (series) to a dataframe simply by assigning a adding to a dataframe.  For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">df['NEW2']=[17,12,14,15]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">.upd()</span></code> provides this functionality as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;c = 142&#39;</span><span class="p">)</span> 
<span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
      <td>142.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>note that the new variable name is in lower case here.  We know that lowercase letters are not legal <code class="docutils literal notranslate"><span class="pre">modelflow</span></code> variable names.  But because the .upd() method knows this also, it automatically translates these into upper case so that the statement works.</p>
</div>
</div>
<div class="section" id="multiple-updates-and-specific-time-periods">
<h3><span class="section-number">10.2.3. </span>multiple updates and specific time periods<a class="headerlink" href="#multiple-updates-and-specific-time-periods" title="Permalink to this headline">¶</a></h3>
<p>The modelflow method <code class="docutils literal notranslate"><span class="pre">.upd()</span></code> takes a string as an argument.  That string can contain a single update command or can contain multiple commands.</p>
<p>The below illustrates this, modifying two existing variables A, B over different time periods and creating a new variable.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Note that the third line inherits the time period of the previous line.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Same number of values as years</span>
<span class="s2">&lt;2021 2024&gt; A = 42 44 45 46    # 4 years</span>
<span class="s2">&lt;2020     &gt; B = 200            # 1 year </span>
<span class="s2">c = 500                        # Same period as previous</span>
<span class="s2">&lt;-0 -1&gt; D = 33                   # All years </span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>200</td>
      <td>500.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>42</td>
      <td>100</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>44</td>
      <td>100</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>45</td>
      <td>100</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>46</td>
      <td>100</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
      <td>0.0</td>
      <td>33.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="highlight-{note notranslate"><div class="highlight"><pre><span></span>**Time scope of .upd()**



The update command takes a variety of mathematical operators ```=, +, \*, % =GROWTH, +GROWTH, =DIFF``` and applies them to data for the period set in the leading &lt;&gt;.

If the user wants to modify a series or group of series for only a specific point in time or a period of time, she can indicate the period in the command line.

 - If **one date** is specified the operation is applied to a single point in time
 - If **two dates**  are specifies the operation is applied over a period of time.

The time will persist until re-set with a new time specification. Useful to avoid visual noise if several variables are going to be updated for the same time period. 

 - To indicate the start of the dataframe use -0
 - To indicate the end of the dataframe use -1
 
If no time is provided the dataframe start and end period will be used.  
</pre></div>
</div>
<div class="section" id="setting-specific-datapoints-to-specific-values">
<h4><span class="section-number">10.2.3.1. </span>Setting specific datapoints to specific values<a class="headerlink" href="#setting-specific-datapoints-to-specific-values" title="Permalink to this headline">¶</a></h4>
<p>In this example, upd uses the equals operator.  This indicates that the variable a should be set equal to the indicated values following the = operator (42 44 45 46 in this example). The dates enclosed in &lt;&gt; indicate the period over which the change should be applied.</p>
<p>Either:</p>
<ul class="simple">
<li><p>The number of data points provided must match the number of dates in the period, Or</p></li>
<li><p>Only one data point is provided, it is applied to all dates in the period.</p></li>
</ul>
<p>If only one period is to be modified then it can be followed by just one date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Same number of values as years</span>
<span class="s2">&lt;2021 2024&gt; A = 42 44 45 46    # 4 years</span>
<span class="s2">&lt;2020     &gt; B = 200            # 1 year </span>
<span class="s2">c = 500</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>200</td>
      <td>500.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>42</td>
      <td>100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>44</td>
      <td>100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>45</td>
      <td>100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>46</td>
      <td>100</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="adding-the-specified-values-to-all-values-in-a-range-the-operator">
<h3><span class="section-number">10.2.4. </span>Adding  the specified  values to all values in a range (the + operator)<a class="headerlink" href="#adding-the-specified-values-to-all-values-in-a-range-the-operator" title="Permalink to this headline">¶</a></h3>
<p>NB: Here upd with the  + operator indicates that we are adding 42.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Or one number to all years in between start and end </span>
<span class="s1">&lt;2022 2024&gt; B  +  42    # one value broadcast to 3 years </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
      <td>142</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>142</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>142</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="multiplying-all-values-in-a-range-by-the-specified-values-the-operator">
<h3><span class="section-number">10.2.5. </span>Multiplying all values in a range by the specified values (the * operator)<a class="headerlink" href="#multiplying-all-values-in-a-range-by-the-specified-values-the-operator" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2023&gt; A *  42 44 55</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>4200</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>4400</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>5500</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator">
<h3><span class="section-number">10.2.6. </span>Increasing all  values in a range by a  specified percent amount (the % operator)<a class="headerlink" href="#increasing-all-values-in-a-range-by-a-specified-percent-amount-the-operator" title="Permalink to this headline">¶</a></h3>
<p>In this example:</p>
<ul class="simple">
<li><p>A is increased by 42 and 44% over the range 2021 through 2022.</p></li>
<li><p>B is increased by 10 percent in all years</p></li>
<li><p>C, a new variable, is created and set to 100 for the whole range</p></li>
<li><p>C is decreased by 12 percent over the range 2023 through 2025.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2022 &gt; A %  42 44   </span>
<span class="s1">&lt;-0 -1&gt; B % 10            # all rows </span>
<span class="s1">C = 100                   # all rows persist </span>
<span class="s1">&lt;2023 2025&gt; C % -12       # now only for 3 years </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>110.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>142</td>
      <td>110.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>144</td>
      <td>110.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>110.0</td>
      <td>88.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>110.0</td>
      <td>88.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>110.0</td>
      <td>88.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="set-the-percent-growth-rate-to-specified-values-growth">
<h3><span class="section-number">10.2.7. </span>Set the percent growth rate to specified values (=GROWTH)<a class="headerlink" href="#set-the-percent-growth-rate-to-specified-values-growth" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2022&gt; A =GROWTH  1 5  </span>
<span class="s1">&lt;2020&gt; c = 100 </span>
<span class="s1">&lt;2021 2025&gt; c =GROWTH 2 </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># Explained b</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
           A    B           C
2020  100.00  100  100.000000
2021  101.00  100  102.000000
2022  106.05  100  104.040000
2023  100.00  100  106.120800
2024  100.00  100  108.243216
2025  100.00  100  110.408080

Growth:
             A    B    C
2020       NaN  NaN  NaN
2021  1.000000  0.0  2.0
2022  5.000000  0.0  2.0
2023 -5.704856  0.0  2.0
2024  0.000000  0.0  2.0
2025  0.000000  0.0  2.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-or-subtract-from-the-existing-percent-growth-rate-growth-operator">
<h3><span class="section-number">10.2.8. </span>Add or subtract from the existing percent growth rate (+GROWTH operator)<a class="headerlink" href="#add-or-subtract-from-the-existing-percent-growth-rate-growth-operator" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2025&gt; A =GROWTH  1  </span>
<span class="s1"># now we add values  to the growth rate, </span>
<span class="s1">a +growth   2 3 4 5 6 </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
               A    B
2020  100.000000  100
2021  103.000000  100
2022  107.120000  100
2023  112.476000  100
2024  119.224560  100
2025  127.570279  100

Growth:
        A    B
2020  NaN  NaN
2021  3.0  0.0
2022  4.0  0.0
2023  5.0  0.0
2024  6.0  0.0
2025  7.0  0.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="set-delta-var-t-var-t-1-to-specified-values-diff-operator">
<h3><span class="section-number">10.2.9. </span>Set <span class="math notranslate nohighlight">\(\Delta = var_t - var_{t-1}\)</span> to specified values (=diff operator)<a class="headerlink" href="#set-delta-var-t-var-t-1-to-specified-values-diff-operator" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt; 2021 2022&gt; A =diff  2 4   </span>
<span class="s1"># cv number to all years in between start and end </span>

<span class="s1">&lt;2020 &gt; same = 100 </span>
<span class="s1">&lt;2021 2025&gt; same =diff  2  </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>SAME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102</td>
      <td>100</td>
      <td>102.0</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>106</td>
      <td>100</td>
      <td>104.0</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>100</td>
      <td>106.0</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
      <td>110.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="recall-that-we-have-not-overwritten-df-so-the-df-dataframe-is-unchanged">
<h3><span class="section-number">10.2.10. </span>Recall  that we have not overwritten df, so the df dataframe is unchanged.<a class="headerlink" href="#recall-that-we-have-not-overwritten-df-so-the-df-dataframe-is-unchanged" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="keep-growth-rates-after-the-update-time-the-kg-option">
<h3><span class="section-number">10.2.11. </span>Keep growth rates after the update time – the –kg option<a class="headerlink" href="#keep-growth-rates-after-the-update-time-the-kg-option" title="Permalink to this headline">¶</a></h3>
<p>In a long projection it can sometime be useful to be able to update variables for which new information is available, but for the subsequent periods keep the growth rate the same as before the update. In database management this is frequently done when two time-series with different levels are spliced together.</p>
<p>The -kg or –keep_growth option instructs modelview to calculate the growth rate of the existing pre-change series, and then use it to preserve the pre-change growth rates of the series for the periods that were <strong>not</strong> changed.</p>
<p>This allows to update variables for which new information is available, but keep the growth rate the same as before the update in the period after the update time.</p>
<div class="section" id="the-default-keep-growth-behaviour">
<h4><span class="section-number">10.2.11.1. </span>The default keep_growth behaviour<a class="headerlink" href="#the-default-keep-growth-behaviour" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">upd()</span></code> method has a parameter <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code>, which by default is equal to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> determines how data in  the time periods after those where an update is executed are treated.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> then data in the sub-period after a change is left unchanged.</p>
<p>if <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is set to “<code class="docutils literal notranslate"><span class="pre">True</span></code>” then the system will preserve the pre-change growth rate of the affected variable in the time period <em>after the change</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the line level:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code> can be expressed as –kg</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code> can be expressed as –nkg</p></li>
</ul>
</div>
<p>Let’s see this in a concrete example.  Consider the following <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> df with two variables A and B, that each grow by 2% per period, with A initialized at a level of 100 and B at a level of 110 so that we can see each separately on a graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="o">+</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_rows</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">])</span> 

<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;2021 -1&gt; A =growth 2</span>
<span class="s2">           &lt;2020 -1&gt;   B = 110</span>
<span class="s2">          &lt;2021 -1&gt;    B =growth 2</span>
<span class="s2">          &quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Store these variables for later use in comparisons</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;A_ORIG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;B_ORIG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>104.040000</td>
      <td>114.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>106.120800</td>
      <td>116.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>108.243216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>110.408080</td>
      <td>121.448888</td>
      <td>110.408080</td>
      <td>121.448888</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../../_images/model update_33_1.png" src="../../../_images/model update_33_1.png" />
</div>
</div>
<p>Now lets modify each by adding 5 to the level in 2022 and 2023.  For B we will do setting the keep_growth option as False and for ‘B’ keep_growth positive.  While the keep_growth is a global variable it can be set at the line level also using the –kg option (<code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code>) and –nkg option ( (<code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;2022 2023&gt; A + 5 --kg</span>
<span class="s2">            &lt;2022 2023&gt; B + 5 --nkg</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A_ORIG&#39;</span><span class="p">,</span><span class="s1">&#39;B_ORIG&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../../_images/model update_35_1.png" src="../../../_images/model update_35_1.png" />
</div>
</div>
<p>In the first example ‘A’ (the green and blue lines) the level of A is increased by 5 for two periods (2021-2022) and then the subsequent values are also increased they were calculated to maintain the growth rate of the original series.</p>
<p>For the ‘B’ variable the same level change was input but because of the <code class="docutils literal notranslate"><span class="pre">--nkg</span></code> (equivalent to <code class="docutils literal notranslate"><span class="pre">keep_growth=False</span></code> ) the periods after the change were affected retained their old values.</p>
<p>Below we plot the growth rates of the two transformed series.</p>
<p>Here series both series accelerate growth in 2022 By slightly less than 5 percentage points because a) the base of each is more than 100, with the base of B being higher (it was initialized at 110). In 2023 teh growth rate of A returns to 2 percent, while the growth rate of B is actually negative because the level (see earlier graph) has fallen back to its original level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfg</span><span class="o">=</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
<span class="n">dfg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../../_images/model update_37_1.png" src="../../../_images/model update_37_1.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Python constructs</strong><br></p>
<blockquote>
<div><p>print(f’Dataframe:\n{res}\n\nGrowth:\n{res.pct_change()*100}\n’)</p>
</div></blockquote>
<p>Uses</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Python construct</p></th>
<th class="text-align:left head"><p>Explanation</p></th>
<th class="text-align:left head"><p>Links</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>‘\n’</p></td>
<td class="text-align:left"><p>A line break</p></td>
<td class="text-align:left"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>dataframe.pct_change</p></td>
<td class="text-align:left"><p>Percentage change between the current and a prior element.</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pct_change.html">Description</a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>f’{varname} = ….’</p></td>
<td class="text-align:left"><p>A f-string, {expression} is replaced by the value of expression</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://www.google.com/search?q=python+f-string&amp;newwindow=1">Search</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="section" id="upd-keep-growth-some-more-examples">
<h2><span class="section-number">10.3. </span>.upd(,,,keep_growth) some more examples<a class="headerlink" href="#upd-keep-growth-some-more-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initialize-a-new-dataframe-first-make-a-dataframe-with-some-growth-rate">
<h3><span class="section-number">10.3.1. </span>Initialize a new dataframe First make a dataframe with some growth rate<a class="headerlink" href="#initialize-a-new-dataframe-first-make-a-dataframe-with-some-growth-rate" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dftest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="o">+</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_rows</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>                                 <span class="c1"># create column name </span>


<span class="n">original</span> <span class="o">=</span> <span class="n">dftest</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&lt;2021 2025&gt; a =growth 1 2 3 4 5&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Levels:</span><span class="se">\n</span><span class="si">{</span><span class="n">original</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">original</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Levels:
               A
2020  100.000000
2021  101.000000
2022  103.020000
2023  106.110600
2024  110.355024
2025  115.872775

Growth:
        A
2020  NaN
2021  1.0
2022  2.0
2023  3.0
2024  4.0
2025  5.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="now-update-a-in-2021-to-2023-to-a-new-value">
<h3><span class="section-number">10.3.2. </span>now update A in 2021 to 2023 to a new value<a class="headerlink" href="#now-update-a-in-2021-to-2023-to-a-new-value" title="Permalink to this headline">¶</a></h3>
<p>Below we do the same operation, the first time we assign the updated value to the dataframe nkg and the default behaviour of <code class="docutils literal notranslate"><span class="pre">keep_growth</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>In the second example we use the <code class="docutils literal notranslate"><span class="pre">-kg</span></code> line option, telling modelview to maintain the growth rates of the dependent variable in the periods after the update is executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nokg</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2025&gt;  a =growth 1 2 3 4 5 </span>
<span class="s1">&lt;2021 2023&gt;  a = 120  </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">kg</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2021 2025&gt;  a =growth 1 2 3 4 5 </span>
<span class="s1">&lt;2021 2023&gt;  a = 120  --kg</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;growth No kg:</span><span class="se">\n</span><span class="si">{</span><span class="n">nokg</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">growth kg:</span><span class="se">\n</span><span class="si">{</span><span class="n">kg</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n\n\n</span><span class="s1">Level No kg:</span><span class="se">\n</span><span class="si">{</span><span class="n">nokg</span><span class="si">}</span><span class="se">\n</span><span class="s1">Level kg:</span><span class="se">\n</span><span class="si">{</span><span class="n">kg</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>growth No kg:
             A
2020       NaN
2021  20.00000
2022   0.00000
2023   0.00000
2024  -8.03748
2025   5.00000
growth kg:
         A
2020   NaN
2021  20.0
2022   0.0
2023   0.0
2024   4.0
2025   5.0


Level No kg:
               A
2020  100.000000
2021  120.000000
2022  120.000000
2023  120.000000
2024  110.355024
2025  115.872775
Level kg:
           A
2020  100.00
2021  120.00
2022  120.00
2023  120.00
2024  124.80
2025  131.04
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the first where KG (keep_growth) <strong>was not set</strong>, because the level was set constant for three periods at 120 the rate of growth was 0 for the final two years of the set period.  But following this update, the level of A in 2023 is 120. With <code class="docutils literal notranslate"><span class="pre">keep_Growth=False</span></code> (its default value)m the level of A in 2024 remains at its unchanged  unchanged (lower) level of 100.35. As a result, the growth rate in 2024 is negative.</p>
<p>In the <strong>–kg</strong> example, the pre-exsting growth rate (of 4%) is applied to the new value of 120 and so the level in 2024 is (120*1.04)=124.8</p>
</div>
<div class="section" id="upd-with-the-option-keep-growth-set-globally">
<h4><span class="section-number">10.3.2.1. </span>.upd() with the option keep_growth set globally<a class="headerlink" href="#upd-with-the-option-keep-growth-set-globally" title="Permalink to this headline">¶</a></h4>
<p>Above we used the line level option –keep_growth or –kg to keep the growth rate for a given operation.</p>
<p>This works because by default the option Keep_growth is set to false, so in effect we are temporarily setting it to true for the specific lines above.</p>
<p>We can also change the keep_growth variable for all the lines by setting the option in the command line.</p>
<p>In the below example we set the global option <code class="docutils literal notranslate"><span class="pre">keep_growth=True</span></code>.</p>
<p>Now as default, all lines will keep the growth rate</p>
<ul class="simple">
<li><p>c,d are updated in 2022 and 2023 and keep the growth rates afterwards</p></li>
<li><p>e the –no_keep_growth in this line prevents the updating 2024-2025</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a data frame</span>
<span class="n">dftest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="o">+</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_rows</span><span class="p">)],</span> <span class="c1"># create row index</span>
       <span class="c1"># equivalent to index=[2020,2021,2022,2023,2024,2025] </span>
       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>                                 <span class="c1"># create column name </span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>109.040000</td>
      <td>119.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>111.120800</td>
      <td>121.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>113.343216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>115.610080</td>
      <td>121.448888</td>
      <td>110.408080</td>
      <td>121.448888</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfres</span> <span class="o">=</span> <span class="n">dftest</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2022 2023&gt; c = 200 </span>
<span class="s1">&lt;2022 2023&gt; d = 300  </span>
<span class="s1">&lt;2022 2023&gt; e = 400  --no_keep_growth </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">keep_growth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># &lt;===  Here we have set the keep_growth to True for the entirety of the command, </span>
                       <span class="c1"># except for e where it is overridden by the --no_keep_growth flag</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">dfres</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">dfres</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataframe:
        A    B      C      D    E
2020  100  100  100.0  100.0  100
2021  100  100  100.0  100.0  100
2022  100  100  200.0  300.0  400
2023  100  100  200.0  300.0  400
2024  100  100  200.0  300.0  100
2025  100  100  200.0  300.0  100

Growth:
        A    B      C      D      E
2020  NaN  NaN    NaN    NaN    NaN
2021  0.0  0.0    0.0    0.0    0.0
2022  0.0  0.0  100.0  200.0  300.0
2023  0.0  0.0    0.0    0.0    0.0
2024  0.0  0.0    0.0    0.0  -75.0
2025  0.0  0.0    0.0    0.0    0.0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="some-more-advanced-example">
<h3><span class="section-number">10.3.3. </span>Some more advanced example<a class="headerlink" href="#some-more-advanced-example" title="Permalink to this headline">¶</a></h3>
<p>These examples continue to use update, but with some examples of how to embed Python loops into commands.</p>
<div class="section" id="first-create-a-string-with-update-lines">
<h4><span class="section-number">10.3.3.1. </span>First create a string with update lines<a class="headerlink" href="#first-create-a-string-with-update-lines" title="Permalink to this headline">¶</a></h4>
<p>In this example we create a string dynamically is comprised of a variety of update statements.  The loop repeats the two lines above replacing the {varname} expression with c d e and f as the loop is executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>                               
 <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;2020     &gt; </span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s1"> = 100 </span>
<span class="s1">      &lt;2021 2025&gt; </span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s1"> =growth 1 2 3 4 5&#39;&#39;&#39;</span>
     <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="s1">&#39;c d e f&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;2020     &gt; c = 100 
      &lt;2021 2025&gt; c =growth 1 2 3 4 5
&lt;2020     &gt; d = 100 
      &lt;2021 2025&gt; d =growth 1 2 3 4 5
&lt;2020     &gt; e = 100 
      &lt;2021 2025&gt; e =growth 1 2 3 4 5
&lt;2020     &gt; f = 100 
      &lt;2021 2025&gt; f =growth 1 2 3 4 5
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em><strong>Python constructs</strong></em></p>
<p>The creation of update lines involves a number of useful python constructs. A short
description:<br></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Python construct</p></th>
<th class="text-align:left head"><p>explanation</p></th>
<th class="text-align:left head"><p>Google</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>‘a b’.split()</p></td>
<td class="text-align:left"><p>splits a string by <code class="docutils literal notranslate"><span class="pre">blanks</span></code>into a list</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://www.google.com/search?q=python+split&amp;newwindow=1">Search</a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>‘\n’.join()</p></td>
<td class="text-align:left"><p>Creates a string from a list of string separated by \n (linebreak)</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://www.google.com/search?q=python+string+join&amp;newwindow=1">Search</a></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>f’{varname} = ….’</p></td>
<td class="text-align:left"><p>A f-string, {varname} is replaced by the value of varname</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://www.google.com/search?q=python+f-string&amp;newwindow=1">Search</a></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>[varname for varname in a_list]</p></td>
<td class="text-align:left"><p>List comprehension which creates an implicit loop</p></td>
<td class="text-align:left"><p><a class="reference external" href="https://www.google.com/search?q=python+list+comprehension&amp;newwindow=1">Search</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-the-update-lines-to-update-a-dataframe">
<h4><span class="section-number">10.3.3.2. </span>Use the update lines to update a dataframe<a class="headerlink" href="#use-the-update-lines-to-update-a-dataframe" title="Permalink to this headline">¶</a></h4>
<p>Here we pass the variable lines to the <code class="docutils literal notranslate"><span class="pre">upd</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfnew</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="n">dfnew</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>101.000000</td>
      <td>101.000000</td>
      <td>101.000000</td>
      <td>101.000000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>109.040000</td>
      <td>119.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
      <td>103.020000</td>
      <td>103.020000</td>
      <td>103.020000</td>
      <td>103.020000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>111.120800</td>
      <td>121.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
      <td>106.110600</td>
      <td>106.110600</td>
      <td>106.110600</td>
      <td>106.110600</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>113.343216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
      <td>110.355024</td>
      <td>110.355024</td>
      <td>110.355024</td>
      <td>110.355024</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>115.610080</td>
      <td>121.448888</td>
      <td>110.408080</td>
      <td>121.448888</td>
      <td>115.872775</td>
      <td>115.872775</td>
      <td>115.872775</td>
      <td>115.872775</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="kg-can-replace-keep-growth-and-nkg-can-replace-non-keep-growth">
<h3><span class="section-number">10.3.4. </span>–kg can replace –keep_growth and –nkg can replace –non_keep_growth<a class="headerlink" href="#kg-can-replace-keep-growth-and-nkg-can-replace-non-keep-growth" title="Permalink to this headline">¶</a></h3>
<p>Just to make typing more easy</p>
</div>
</div>
<div class="section" id="update-several-variable-in-one-line">
<h2><span class="section-number">10.4. </span>Update several variable in one line<a class="headerlink" href="#update-several-variable-in-one-line" title="Permalink to this headline">¶</a></h2>
<p>Sometime there is a need to update several variable with the same value over the same time frame. To ease this case .update can accept several variables in one line</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;2022 2024&gt; h i j k =      40 </span>
<span class="s1">&lt;2020&gt;      p q r s =       1000</span>
<span class="s1">&lt;2021 -1&gt;   p q r s =growth 2     # -1 indicates the last year </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
      <th>H</th>
      <th>I</th>
      <th>J</th>
      <th>K</th>
      <th>P</th>
      <th>Q</th>
      <th>R</th>
      <th>S</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
      <td>1020.000000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>109.040000</td>
      <td>119.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
      <td>1040.400000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>111.120800</td>
      <td>121.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
      <td>1061.208000</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>113.343216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>40.0</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
      <td>1082.432160</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>115.610080</td>
      <td>121.448888</td>
      <td>110.408080</td>
      <td>121.448888</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
      <td>1104.080803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="upd-scale-number-default-1-scale-the-updates">
<h2><span class="section-number">10.5. </span>.upd(,,scale=&lt;number, default=1&gt;) Scale the updates<a class="headerlink" href="#upd-scale-number-default-1-scale-the-updates" title="Permalink to this headline">¶</a></h2>
<p>When running a scenario it can be useful to be able to create a number of scenarios based on one update but with different scale.</p>
<p>This can be particularly useful when we want to do sensitivity analyses of model results, depending on how heavily a shocked variable is hit</p>
<p>When using the scale option, scale=0  the baseline while scale=0.5 is a scenario half
the severity.</p>
<p>In the example below the values of the dataframes are printed. We use the scale option (setting to to 0, 0.5 and 1) to run three scenarios using the same code but where the update in each case is multiplied by either 0, 0.5 or 1.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we are just printing the outputs, a more interesting example would involve the solving a  model using different levels of a given shock.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;input dataframe: </span><span class="se">\n</span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span> 
    <span class="c1"># First make a dataframe with some growth rate </span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;2021 2025&gt;</span>
<span class="s1">    a =growth 1 2 3 4 5 </span>
<span class="s1">    b + 10</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">severity</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">severity</span><span class="si">=}</span><span class="se">\n</span><span class="s1">Dataframe:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Growth:</span><span class="se">\n</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#  </span>
    <span class="c1"># Here the updated dataframe is only printed. </span>
    <span class="c1"># A more realistic use case is to simulate a model like this: </span>
    <span class="c1"># dummy_ = mpak(res,keep=&#39;Severity {serverity}&#39;)    # more realistic </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>input dataframe: 
               A           B      A_ORIG      B_ORIG
2020  100.000000  110.000000  100.000000  110.000000
2021  102.000000  112.200000  102.000000  112.200000
2022  109.040000  119.444000  104.040000  114.444000
2023  111.120800  121.732880  106.120800  116.732880
2024  113.343216  119.067538  108.243216  119.067538
2025  115.610080  121.448888  110.408080  121.448888


severity=0
Dataframe:
          A           B      A_ORIG      B_ORIG
2020  100.0  110.000000  100.000000  110.000000
2021  100.0  112.200000  102.000000  112.200000
2022  100.0  119.444000  104.040000  114.444000
2023  100.0  121.732880  106.120800  116.732880
2024  100.0  119.067538  108.243216  119.067538
2025  100.0  121.448888  110.408080  121.448888

Growth:
        A         B  A_ORIG  B_ORIG
2020  NaN       NaN     NaN     NaN
2021  0.0  2.000000     2.0     2.0
2022  0.0  6.456328     2.0     2.0
2023  0.0  1.916279     2.0     2.0
2024  0.0 -2.189501     2.0     2.0
2025  0.0  2.000000     2.0     2.0


severity=0.5
Dataframe:
               A           B      A_ORIG      B_ORIG
2020  100.000000  110.000000  100.000000  110.000000
2021  100.500000  117.200000  102.000000  112.200000
2022  101.505000  124.444000  104.040000  114.444000
2023  103.027575  126.732880  106.120800  116.732880
2024  105.088126  124.067538  108.243216  119.067538
2025  107.715330  126.448888  110.408080  121.448888

Growth:
        A         B  A_ORIG  B_ORIG
2020  NaN       NaN     NaN     NaN
2021  0.5  6.545455     2.0     2.0
2022  1.0  6.180887     2.0     2.0
2023  1.5  1.839285     2.0     2.0
2024  2.0 -2.103118     2.0     2.0
2025  2.5  1.919399     2.0     2.0


severity=1
Dataframe:
               A           B      A_ORIG      B_ORIG
2020  100.000000  110.000000  100.000000  110.000000
2021  101.000000  122.200000  102.000000  112.200000
2022  103.020000  129.444000  104.040000  114.444000
2023  106.110600  131.732880  106.120800  116.732880
2024  110.355024  129.067538  108.243216  119.067538
2025  115.872775  131.448888  110.408080  121.448888

Growth:
        A          B  A_ORIG  B_ORIG
2020  NaN        NaN     NaN     NaN
2021  1.0  11.090909     2.0     2.0
2022  2.0   5.927987     2.0     2.0
2023  3.0   1.768240     2.0     2.0
2024  4.0  -2.023293     2.0     2.0
2025  5.0   1.845042     2.0     2.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="upd-lprint-true-prints-values-the-before-and-after-update">
<h2><span class="section-number">10.6. </span>.upd(,,lprint=True ) prints values the before and after update<a class="headerlink" href="#upd-lprint-true-prints-values-the-before-and-after-update" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">lPrint</span></code> option of the method <code class="docutils literal notranslate"><span class="pre">upd()</span></code> is by defualt <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">False</span></code>.  By setting it true an update command will output the results of the calculation comapriong the values of the dataframe (over the impacted period) before, after and the difference between the two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># Same number of values as years</span>
<span class="s1">&lt;2021 2022&gt; A *  42 44</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">lprint</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Update * [42.0, 44.0] 2021 2022
A                    Before                After                 Diff
2021               102.0000            4284.0000            4182.0000
2022               109.0400            4797.7600            4688.7200
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>A_ORIG</th>
      <th>B_ORIG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>100.000000</td>
      <td>110.000000</td>
      <td>100.000000</td>
      <td>110.000000</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>4284.000000</td>
      <td>112.200000</td>
      <td>102.000000</td>
      <td>112.200000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>4797.760000</td>
      <td>119.444000</td>
      <td>104.040000</td>
      <td>114.444000</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>111.120800</td>
      <td>121.732880</td>
      <td>106.120800</td>
      <td>116.732880</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>113.343216</td>
      <td>119.067538</td>
      <td>108.243216</td>
      <td>119.067538</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>115.610080</td>
      <td>121.448888</td>
      <td>110.408080</td>
      <td>121.448888</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="upd-create-true-requires-the-variable-to-exist">
<h2><span class="section-number">10.7. </span>.upd(,,create=True ) Requires the variable to exist<a class="headerlink" href="#upd-create-true-requires-the-variable-to-exist" title="Permalink to this headline">¶</a></h2>
<p>Until now .upd has created variables if they did not exist in the input dataframe.</p>
<p>To catch misspellings the parameter <code class="docutils literal notranslate"><span class="pre">create</span></code> can be set to False.
New variables will not be created, and an exception will be raised.</p>
<p>Here Pythons exception handling is used, so the notebook will continue to run the cells below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">upd</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    # Same number of values as years</span>
<span class="s1">    &lt;2021 2022&gt; Aa *  42 44</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span><span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable to update not found:AA, timespan = [2021 2022] 
Set create=True if you want the variable created: 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-call">
<h2><span class="section-number">10.8. </span>The call<a class="headerlink" href="#the-call" title="Permalink to this headline">¶</a></h2>
<p>def upd(indf, updates, lprint=False,scale = 1.0,create=True,keep_growth=False,start=’’,end=’’)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Args:
        indf (DataFrame): input dataframe.
        basis (string): lines with variable updates look below.
        lprint (bool, optional): if True each update is printed  Defaults to False.
        scale (float, optional): A multiplier used on all update input . Defaults to 1.0.
        create (bool, optional): Creates a variables if not in the dataframe . Defaults to True.
        keep_growth(bool, optional): Keep the growth rate after the update time frame. Defaults to False.

    Returns:
        df (TYPE): the updated dataframe .
        
    A line in updates looks like this:     
           
    &quot;&lt;&quot;[[start] end]&quot;&gt;&quot; &lt;var....&gt; &lt;=|+|*|%|=growth|+growth|=diff&gt; &lt;value&gt;...  [--keep_growth_rate|--no_keep_growth_rate]
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content\howto\update"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../../notebooks/PythonPackagesEtc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Some Python basics</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="extending_dataframes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">11. </span><code class="docutils literal notranslate"><span class="pre">.mfcalc()</span></code> an extension of standard Pandas</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Andrew Burns and Ib Hansen<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>